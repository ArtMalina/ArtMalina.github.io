(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{226:function(e,t,n){n(227),e.exports=n(460)},450:function(e,t,n){},455:function(e,t,n){},456:function(e,t,n){},457:function(e,t,n){},458:function(e,t,n){},459:function(e,t,n){},460:function(e,t,n){"use strict";n.r(t);var o,r,c=n(0),a=n.n(c),i=n(221),u=n.n(i),s=(n(450),n(71)),l=n(57),b=function(e){return a.a.createElement("div",{className:"container"},"Home!")},f=function(e){return a.a.createElement("div",{className:"container"},"About!")},g=function(e){return function(){return a.a.createElement("div",{className:"container content-box"},a.a.createElement(l.c,null,a.a.createElement(l.a,{exact:!0,path:"/",component:b}),a.a.createElement(l.a,{exact:!0,path:"/about",component:f}),a.a.createElement(l.a,{exact:!0,path:"/workspace",component:e})))}},m=(n(455),function(e){return a.a.createElement("nav",null,a.a.createElement("div",{className:"flex-item"},a.a.createElement("h1",null,e.title)),a.a.createElement("div",{className:"links-container"},a.a.Children.map(e.children,function(e){return a.a.createElement("div",{className:"link-item"},e)})))}),p=n(1),O=n(4);!function(e){e.HTML="<HTML>",e.SVG="<SVG>",e.CANVAS_2D="CANVAS_2D",e.WEBGL="WEBGL"}(o||(o={})),function(e){e.Anchor="Anchor",e.Box="Box",e.Container="Container",e.DragFrame="DragFrame",e.MagnetCornerFrame="MagnetCornerFrame",e.MagnetBorderFrame="MagnetBorderFrame",e.SelectedFrame="SelectedFrame"}(r||(r={}));var d,j,v,h,L,R,B,T=function(e){var t=e.handlers||{},n=e.classModifiers||[];return a.a.createElement("div",Object.assign({},t,{className:"block_anchor".concat(n.length?" "+n.map(function(e){return"block_anchor--".concat(e)}).join(" "):""),style:{marginLeft:0,marginTop:0}}))},x=[[o.HTML,T]],E=T,M=n(3),y=n(5),w=(n(456),function(e){var t=e.classModifiers||[],n=e.classBlocks||[],o=e.classElements||[],r=e.handlers||{},c=Object(y.a)(t).map(function(e){return"block--".concat(e)}).join(" "),i=n[0]||"",u=Object(y.a)(o).map(function(e){return i&&"".concat(i,"_").concat(e)}).join(" "),s=e.style||{};return a.a.createElement("div",Object.assign({},r,{className:"box-item box-item--div".concat(i?" "+i:"").concat(c?" "+c:"").concat(u?" "+u:""),style:Object(M.a)({left:e.position[0],top:e.position[1],width:e.size[0],height:e.size[1]},s)}),e.children)}),z=[[o.HTML,w]],S=w,k=(n(457),function(e){var t=e.classModifiers||[],n=e.handlers||{},o=e.style||{},r=t.map(function(e){return"block--".concat(e)}).join(" "),i=Object(c.useRef)(null);return Object(c.useEffect)(function(){i.current&&e.setRef&&e.setRef(i.current)},[i,e]),a.a.createElement("div",Object.assign({},n,{ref:i,className:"container block ".concat(r),style:Object(M.a)({},o)}),e.children)}),V=[[o.HTML,k]],_=k;!function(e){e.None="<none>",e.Hover="<hover>",e.InGroup="<in-group>",e.HoverInGroup="<hover-in-group>",e.JustMove="<just-move(?)>",e.MoveByHand="<move-by-hand>",e.MoveByHandInGroup="<move-by-hand-in-group>",e.MoveInGroup="<move-in-group>"}(d||(d={})),function(e){e[e.None=0]="None",e[e.JustMove=1]="JustMove",e[e.JustActive=2]="JustActive",e[e.InGroup=3]="InGroup",e[e.MoveAndSelect=4]="MoveAndSelect",e[e.MoveInGroup=5]="MoveInGroup",e[e.Resize=6]="Resize"}(j||(j={})),function(e){e.TopLeft="<TopLeft>",e.TopLeft_TopLeft="<TopLeft-TopLeft>",e.TopLeft_TopRight="<TopLeft-TopRight>",e.TopLeft_LeftTop="<TopLeft-LeftTop>",e.TopLeft_LeftBottom="<TopLeft-LeftBottom>",e.TopRight="<TopRight>",e.TopRight_TopLeft="<TopRight-TopLeft>",e.TopRight_TopRight="<TopRight-TopRight>",e.TopRight_RightTop="<TopRight-RightTop>",e.TopRight_RightBottom="<TopRight-RightBottom>",e.BottomRight="<BottomRight>",e.BottomRight_RightTop="<BottomRight-RightTop>",e.BottomRight_RightBottom="<BottomRight-RightBottom>",e.BottomRight_BottomRight="<BottomRight-BottomRight>",e.BottomRight_BottomLeft="<BottomRight-BottomLeft>",e.BottomLeft="<BottomLeft>",e.BottomLeft_BottomRight="<BottomLeft-BottomRight>",e.BottomLeft_BottomLeft="<BottomLeft-BottomLeft>",e.BottomLeft_LeftBottom="<BottomLeft-LeftBottom>",e.BottomLeft_LeftTop="<BottomLeft-LeftTop>",e.Left_Vertical="<left-vertical>",e.Right_Vertical="<right-vertical>",e.Top_Horizontal="<top-horizontal>",e.Bottom_Horizontal="<bottom-horizontal>",e.RightTop="<RightTop>",e.RightBottom="<RightBottom>",e.LeftTop="<LeftTop>",e.LeftBottom="<LeftBottom>",e.None="<None>"}(v||(v={})),function(e){e.StartDrag="StartDrag",e.DragInGroup="DragInGroup",e.Move="Move",e.Resize="Resize",e.StopResize="StopResize",e.StopDrag="StopDrag",e.Cancel="Cancel",e.StartSelecting="StartSelecting",e.StopSelecting="StopSelecting"}(h||(h={})),function(e){e[e.In=1]="In",e[e.Out=-1]="Out"}(L||(L={})),function(e){e[e.In=1]="In",e[e.Out=-1]="Out"}(R||(R={})),function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"}(B||(B={}));var $,I,N,H,C,D=function(e){var t=e.size,n=e.activeLevel,o=n!==d.None&&n!==d.InGroup,r=o?20:0,c={width:t[0]+r,height:t[1]+r,marginLeft:-r/2,marginTop:-r/2,borderWidth:4,padding:o?r/2-4:0};return a.a.createElement("div",{className:"block_frame block_frame--".concat(o?"drag":"no-drag"),style:c},e.children)},G=[[o.HTML,D]],A=D,P=function(e){var t=e.type,n=e.indent,o=e.offset,r=null!==t?function(e,t,n){var o=Object(p.a)(t,4),r=o[0],c=o[1],a=o[2],i=o[3],u={width:20,height:20},s={borderTopStyle:"solid",borderLeftStyle:"solid"},l={borderTopStyle:"solid",borderRightStyle:"solid"},b={borderBottomStyle:"solid",borderLeftStyle:"solid"},f={borderBottomStyle:"solid",borderRightStyle:"solid"},g={borderColor:"lime"},m=n?{borderLeftStyle:"solid"}:{borderRightStyle:"solid"},O=n?{borderBottomStyle:"solid"}:{borderTopStyle:"solid"},d={};switch(e){case v.TopLeft_LeftBottom:u=Object(M.a)({},u,l,{left:-i-20,top:0});break;case v.TopLeft_LeftTop:u=Object(M.a)({},u,f,{left:-i-20,top:-20});break;case v.TopLeft_TopLeft:u=Object(M.a)({},u,f,{left:-20,top:-r-20});break;case v.TopLeft_TopRight:u=Object(M.a)({},u,b,{left:0,top:-r-20});break;case v.TopRight_TopLeft:u=Object(M.a)({},u,f,{right:0,top:-r-20});break;case v.TopRight_TopRight:u=Object(M.a)({},u,b,{right:-20,top:-r-20});break;case v.TopRight_RightTop:u=Object(M.a)({},u,b,{right:-c-20,top:-20});break;case v.TopRight_RightBottom:u=Object(M.a)({},u,s,{right:-c-20,top:0});break;case v.BottomRight_RightTop:u=Object(M.a)({},u,b,{right:-c-20,bottom:0});break;case v.BottomRight_RightBottom:u=Object(M.a)({},u,s,{right:-c-20,bottom:-20});break;case v.BottomRight_BottomRight:u=Object(M.a)({},u,s,{right:-20,bottom:-a-20});break;case v.BottomRight_BottomLeft:u=Object(M.a)({},u,l,{right:0,bottom:-a-20});break;case v.BottomLeft_BottomRight:u=Object(M.a)({},u,s,{left:0,bottom:-a-20});break;case v.BottomLeft_BottomLeft:u=Object(M.a)({},u,l,{left:-20,bottom:-a-20});break;case v.BottomLeft_LeftBottom:u=Object(M.a)({},u,l,{left:-i-20,bottom:-20});break;case v.BottomLeft_LeftTop:u=Object(M.a)({},u,f,{left:-i-20,bottom:0});break;case v.Left_Vertical:d=n?{width:1,top:5-r}:{width:1,bottom:5-a},u=Object(M.a)({},u,g,m,{left:0},d);break;case v.Right_Vertical:d=n?{width:1,top:5-r}:{width:1,bottom:5-a},u=Object(M.a)({},u,g,m,{right:0},d);break;case v.Top_Horizontal:d=n?{height:1,left:5-i}:{height:1,right:5-c},u=Object(M.a)({},u,g,O,{top:0},d);break;case v.Bottom_Horizontal:d=n?{height:1,left:5-i}:{height:1,right:5-c},u=Object(M.a)({},u,g,O,{bottom:0},d);break;case v.None:u.width=0,u.height=0,u.top=0,u.left=0;break;default:u.width=0,u.height=0,u.top=0,u.left=0}return Object(M.a)({},u)}(t,n,o):{top:0,left:0,width:0,height:0};return a.a.createElement("div",{className:"block_magnet-corner-frame",style:Object(M.a)({},r)})},F=[[o.HTML,P]],J=P,U=function(e){var t=e.markerPosition,n=e.size;return a.a.createElement("div",{className:"block_magnet-frame block_magnet-frame--".concat(!t||t[1]?"disabled":"active"),style:{marginTop:-40,marginLeft:-40,width:n[0]+80,height:n[1]+80}})},W=[[o.HTML,U]],q=U,X=function(e){var t=e.activeLevel||d.None,n=t===d.InGroup||t===d.MoveInGroup||t===d.HoverInGroup||t===d.MoveByHandInGroup,o=n?10:0,r=e.size[0]+o,c=e.size[1]+o,i=-o/2,u=-o/2;return a.a.createElement("div",{className:"block_frame block_frame--".concat(n?"selected":"not-selected"),style:{width:r,height:c,marginLeft:i,marginTop:u}},e.children)},Y=[[o.HTML,X]],K=X,Q=($={},Object(O.a)($,r.Anchor,x),Object(O.a)($,r.Box,z),Object(O.a)($,r.Container,V),Object(O.a)($,r.DragFrame,G),Object(O.a)($,r.MagnetCornerFrame,F),Object(O.a)($,r.MagnetBorderFrame,W),Object(O.a)($,r.SelectedFrame,Y),$),Z=function(){return null},ee=(I=o.HTML,{getBlock:function(e){return(Q[e]||[I,Z])[0][1]}}),te=ee.getBlock(r.Box),ne=ee.getBlock(r.Container),oe=function(e){var t=e.size,n=e.xy;return t[0]&&t[1]?a.a.createElement(te,Object.assign({},e,{classModifiers:["silver-bordered"]}),a.a.createElement(ne,{style:{width:t[0],height:t[1]}},e.children),a.a.createElement("div",{style:{fontSize:"12px",position:"absolute",bottom:2,right:2}},a.a.createElement("div",null,"sx=",t[0]),a.a.createElement("div",null,"sy= ",t[1])),a.a.createElement("div",{style:{fontSize:"12px",position:"absolute",bottom:2,left:2}},a.a.createElement("div",null,"x=",n[0]),a.a.createElement("div",null,"y= ",n[1]))):null},re=n(225),ce=n(462),ae=n(469),ie=n(463),ue=n(224),se=n(468),le=n(464),be=function(e,t){return function(n){return function(o){var r=Object(c.useRef)(t),i=Object(c.useMemo)(function(){return r.current.reduce(function(e,t){return Object(M.a)({},e,t[0])},{})},[r]),u=Object(c.useMemo)(function(){return Object(M.a)({dragStart:new re.a,drag:new re.a,dragStop:new re.a,control:new ce.a(null),group:new ce.a([]),deltaMoves:new re.a,mouseDown:new re.a,mouseMove:new re.a,mouseUp:new re.a,mouseLeave:new re.a,mouseStop:new re.a},i)},[i]);Object(c.useEffect)(function(){console.log("%c start launch plugins ","color: yellow; background-color: darkgreen");var e=r.current.map(function(e){var t=Object(p.a)(e,2),n=(t[0],(0,t[1])(u));return Object(p.a)(n,1)[0]}),t=function(){var t=e.map(function(e){return e()});return function(){t.forEach(function(e){return e&&e()})}}();return function(){console.log("%c stop launch plugins ","color: lime; background-color: darkgreen"),t()}},[u,r]);var s=Object(c.useMemo)(function(){return u.mouseDown.pipe(Object(ie.a)(function(e){return console.warn("tap mouseDowen elementid",e.elementId,e.type)}),Object(ue.a)(function(e){return[e.elementId,Object(M.a)({},e)]}))},[u]),l=Object(c.useMemo)(function(){return s.pipe(Object(ie.a)(function(e){var t=Object(p.a)(e,1)[0];return console.log("start moving!",t)}),Object(se.a)(function(e){return Object(ae.a)(new ce.a(e),u.mouseMove).pipe(Object(le.a)(u.mouseStop.pipe(Object(ie.a)(function(e){var t=e.ev,n=u.control.getValue();u.dragStop.next({elementId:n,ev:t,type:h.StopDrag}),u.control.next(null)}))))}))},[u,s]);Object(c.useEffect)(function(){console.warn("\n\n effect in stream-container");var e=l.subscribe(function(e){var t=Object(p.a)(e,2),n=Object(p.a)(t[0],2),o=n[0],r=n[1],c=t[1],a=[r.ev.clientX,r.ev.clientY],i=a[0],s=a[1];u.deltaMoves.next([o,[c.ev.clientX-i,c.ev.clientY-s]]),u.drag.next(Object(M.a)({},c,{elementId:u.control.getValue()}))}),t=s.subscribe(function(e){var t=Object(p.a)(e,2),n=t[0],o=t[1];u.dragStart.next({elementId:n,type:h.StartDrag,ev:o.ev})}),n=u.mouseStop.subscribe(function(e){var t=u.control.getValue();console.log("stop listening in main Drag container",t)});return function(){console.log("\n\n clear in stream-container"),u.mouseDown.complete(),u.mouseMove.complete(),u.mouseStop.complete(),u.control.complete(),u.deltaMoves.complete(),e.unsubscribe(),t.unsubscribe(),n.unsubscribe()}},[u,l,s]);var b=Object(c.useMemo)(function(){return{onMouseDown:function(e){},onMouseMove:function(e){u.mouseMove.next({elementId:"root",ev:e.nativeEvent,type:h.Move})},onMouseUp:function(e){u.mouseUp.next({elementId:"root",ev:e.nativeEvent,type:h.Cancel}),u.mouseStop.next({elementId:"root",ev:e.nativeEvent,type:h.Cancel})},onMouseLeave:function(e){u.mouseLeave.next({elementId:"root",ev:e.nativeEvent,type:h.Cancel}),u.mouseStop.next({elementId:"root",ev:e.nativeEvent,type:h.Cancel})}}},[u]);return a.a.createElement(n,Object.assign({},o,{handlers:b}),a.a.createElement(e.Provider,{value:u},o.children))}}},fe=n(92),ge=n(118),me=n(119),pe=(n(17),n(465),"_init-action_"),Oe=function(){function e(t,n){Object(ge.a)(this,e),this.state=t,this._reducers=n,this.change=new ce.a({type:pe,payload:null}),this._actionSub=void 0,this._actionSub=this.change.pipe().subscribe(function(e){console.log("action change: ",e)})}return Object(me.a)(e,[{key:"dispatch",value:function(e){return console.log("---\x3edispatch action: ",e),this.change}},{key:"close",value:function(){this.change.complete(),this._actionSub.unsubscribe()}}]),e}(),de=a.a.createContext(null),je=de,ve=function(){function e(t,n){Object(ge.a)(this,e),this._services=t,this._selectors=n}return Object(me.a)(e,[{key:"send",value:function(e,t){this._services.filter(function(t){return Object(p.a)(t,1)[0]===e}).forEach(function(e){var n=Object(p.a)(e,2);n[0];return(0,n[1])(t)})}},{key:"get",value:function(e,t){var n=this._selectors.find(function(t){var n=Object(p.a)(t,2),o=n[0];n[1];return o===e});return!n&&console.log("%c no selector -> ".concat(e," "),"background-color: magenta; color: yellow"),n&&n[1](t)}}]),e}(),he=function(e){var t=Object(c.useState)(e.getValue()),n=Object(p.a)(t,2),o=n[0],r=n[1];return Object(c.useEffect)(function(){var t=e.subscribe(function(e){return r(e)});return function(){return t.unsubscribe()}},[e]),[o,r]},Le=function(e,t,n){var o=Object(c.useContext)(je);return Object(c.useMemo)(function(){return console.log("%c storage--\x3e","color: green",e,t,n),new ve(t.map(function(e){var t=Object(p.a)(e,2);return[t[0],(0,t[1])(o)]}),n.map(function(e){var t=Object(p.a)(e,2);return[t[0],(0,t[1])(o)]}))},[e,o,t,n])},Re=function(e){return function(t){var n=t.guid,o=t.size$,r=t.position$,i=t.xy$,u=t.activeLevel$,s=Object(fe.a)(t,["guid","size$","position$","xy$","activeLevel$"]),l=Object(c.useState)(i.getValue()),b=Object(p.a)(l,2),f=b[0],g=b[1],m=Object(c.useState)(r.getValue()),O=Object(p.a)(m,2),d=O[0],j=O[1],v=Object(c.useState)(o.getValue()),h=Object(p.a)(v,2),L=h[0],R=h[1],B=Object(c.useState)(u.getValue()),T=Object(p.a)(B,2),x=T[0],E=T[1];return Object(c.useEffect)(function(){var e=i.subscribe(function(e){var t=Object(p.a)(e,2),n=t[0],o=t[1];requestAnimationFrame(function(){g([n,o])})}),t=r.subscribe(function(e){var t=Object(p.a)(e,2),n=t[0],o=t[1];requestAnimationFrame(function(){j([n,o])})}),c=o.subscribe(function(e){var t=Object(p.a)(e,2),n=t[0],o=t[1];requestAnimationFrame(function(){R([n,o])})}),a=u.subscribe(function(e){requestAnimationFrame(function(){E(e)})});return function(){console.log("unsubscribe WrappedBlock",n),t.unsubscribe(),e.unsubscribe(),c.unsubscribe(),a.unsubscribe()}},[n,o,r,i,u]),a.a.createElement(e,Object.assign({},s,{guid:n,xy:f,position:d,size:L,activeLevel:x}),t.children)}},Be=function(e){return function(t){var n=t.guid,o=t.size$,r=t.position$,i=t.xy$,u=t.activeLevel$,s=Object(fe.a)(t,["guid","size$","position$","xy$","activeLevel$"]),l=o.getValue(),b=u.getValue(),f=Object(c.useMemo)(function(){return r.getValue()},[r]),g=Object(c.useState)(i.getValue()),m=Object(p.a)(g,2),O=m[0],d=m[1];return Object(c.useEffect)(function(){var e=i.subscribe(function(e){var t=Object(p.a)(e,2),n=t[0],o=t[1];requestAnimationFrame(function(){r.next([n,o]),d([n,o])})});return function(){console.log("unsubscribe ConnectedBlock",n),e.unsubscribe()}},[n,r,i]),a.a.createElement(e,Object.assign({},s,{guid:n,xy:O,position:f,size:l,activeLevel:b}),t.children)}},Te=n(466),xe=Re(S),Ee=function(e){return function(t){var n=t.position$,o=t.size$,r=t.xy$,i=t.activeLevel$,u=Object(fe.a)(t,["position$","size$","xy$","activeLevel$"]),s=t.guid,l=t.handlers,b=Object(c.useContext)(rt),f=Object(c.useState)(!1),g=Object(p.a)(f,2),m=g[0],O=g[1],j=he(o),v=Object(p.a)(j,1)[0],h=Object(c.useRef)(i.getValue()),L=Object(c.useMemo)(function(){return new ce.a([0,0])},[]),R=Object(c.useMemo)(function(){return function(e){return l&&l.onMouseDown&&l.onMouseDown(e)}},[l]);Object(c.useEffect)(function(){var e=L.pipe(Object(Te.a)(function(e,t){return t>0})).subscribe(function(e){var t=Object(p.a)(e,2),o=t[0],r=t[1];n.next([o,r])});return function(){e.unsubscribe()}},[s,r,n,L,i]);var B=Object(c.useMemo)(function(){return{onMouseDown:function(e){R(e)}}},[R]),T=Object(c.useMemo)(function(){return new re.a},[]),x=Object(c.useMemo)(function(){return l?Object(M.a)({},l,{onMouseEnter:function(){T.next(1)},onMouseLeave:function(){T.next(-1)},onMouseDown:function(e){"root"===s&&R(e),"root"!==s&&e.stopPropagation()}}):{}},[T,s,l,R]);Object(c.useEffect)(function(){var e=T.pipe(Object(Te.a)(function(e){return!b.control.getValue()||b.control.getValue()===s}),Object(Te.a)(function(e){return 1!==e||[d.None,d.InGroup].includes(i.getValue())}),Object(Te.a)(function(e){return-1!==e||[d.Hover,d.HoverInGroup].includes(i.getValue())})).subscribe(function(e){var t=i.getValue();1===e?(h.current=t,t=(t=t===d.None?d.Hover:t)===d.InGroup?d.HoverInGroup:t):t=h.current,i.next(t),O(1===e)});return function(){console.log("unsubscribe DragFrame",s),e.unsubscribe()}},[s,T,b,i,h]);var w=i.getValue(),z="root"!==s?["hoverable"]:[],S=[].concat(z,w?["draggable","drag-start"]:["draggable"]),k=t.classModifiers||[],V=w?[].concat(Object(y.a)(k),["wrapped-by-drag"]):Object(y.a)(k),_="root"!==s&&"selecting-frame"!==s;return a.a.createElement(xe,Object.assign({},t,{style:null,activeLevel:w,handlers:Object(M.a)({},x),classModifiers:S}),a.a.createElement(A,Object.assign({},u,{activeLevel:w,handlers:null,size:[v[0],v[1]],xy:[0,0],position:[0,0]}),_&&w!==d.MoveInGroup&&w!==d.InGroup&&a.a.createElement(E,Object.assign({},t,{handlers:Object(M.a)({},B),activeLevel:w,classModifiers:m&&_?["active"]:[]})),a.a.createElement(e,Object.assign({},t,{classModifiers:V,position$:L}),t.children)))}},Me=function(e){return function(t,n){return function(o,r,i){var u=e(o);return function(e){var o=e.guid,i=e.position$,s=e.xy$,l=e.activeLevel$,b=Object(c.useContext)(t),f=Le("draggable: ".concat(o),r,[]),g=Object(c.useRef)(s.getValue()),m=Object(c.useRef)(l.getValue()),O=Object(c.useMemo)(function(){return n(o,b)},[o,b]);return Object(c.useEffect)(function(){var e=b.deltaMoves.pipe(Object(Te.a)(function(e){var t=Object(p.a)(e,1)[0];return o===t})).subscribe(function(e){var t=Object(p.a)(e,2),n=(t[0],t[1]),r=Object(p.a)(n,2),c=r[0],a=r[1],i=Object(p.a)(g.current,2),u=c+i[0],l=a+i[1];f.send("position",[o,[u,l]]),s.next([u,l])});return function(){return e.unsubscribe()}},[b,f,o,s]),Object(c.useEffect)(function(){var e=b.dragStop.pipe(Object(Te.a)(function(e){return e.elementId===o})).subscribe(function(e){l.next(m.current);var t=i.getValue(),n=Object(p.a)(t,2),o=n[0],r=n[1];g.current=[o,r]}),t=b.dragStart.pipe(Object(Te.a)(function(e){return e.elementId===o})).subscribe(function(e){var t=e.type;m.current=l.getValue();var n=t===h.DragInGroup?d.MoveInGroup:m.current;t!==h.DragInGroup&&(n=(n=n===d.Hover?d.MoveByHand:n)===d.HoverInGroup?d.MoveByHandInGroup:n),l.next(n);var o=i.getValue(),r=Object(p.a)(o,2),c=r[0],a=r[1];g.current=[c,a]});return function(){t.unsubscribe(),e.unsubscribe()}},[o,b,i,s,l,g,m]),a.a.createElement(u,Object.assign({},e,{handlers:O}),e.children)}}}},ye={magneted:new ce.a([]),magneting:new re.a,magnetingStart:new re.a},we=function(e){return[e]},ze=[Object(M.a)({},ye),function(e){return[(t=e,function(){var e=t.magnetingStart.pipe(Object(ie.a)(function(e){return"selecting-frame"!==e&&"root"!==e}),Object(se.a)(function(e){return t.magneting.pipe(Object(ie.a)(function(e){var n=t.magneted.getValue(),o=Object(p.a)(e.items,1)[0],r=e.direction===R.In?e.items[1]:null,c=e.direction===R.In?n.filter(function(e){return e.magneted[0]!==o||e.magneted[1]!==r}):[],a=e.direction===R.In?[].concat(Object(y.a)(c),[{magneted:[o,r],type:e.type}]):[],i=e.direction===R.Out?n.filter(function(e){return!e.magneted.includes(o)}):[];t.magneted.next([].concat(Object(y.a)(a),Object(y.a)(i)))}),Object(le.a)(t.mouseStop))})).subscribe(function(e){});return function(){e.unsubscribe()}}),we(e)];var t}];!function(e){e.LeftVertical="left-vertical",e.RightVertical="right-vertical",e.TopHorizontal="top-horizontal",e.BottomHorizontal="bottom-horizontal",e.None="none"}(C||(C={}));var Se,ke,Ve,_e,$e,Ie,Ne,He=(N={},Object(O.a)(N,C.LeftVertical,v.Left_Vertical),Object(O.a)(N,C.RightVertical,v.Right_Vertical),Object(O.a)(N,C.TopHorizontal,v.Top_Horizontal),Object(O.a)(N,C.BottomHorizontal,v.Bottom_Horizontal),N),Ce=(H={},Object(O.a)(H,v.Left_Vertical,C.LeftVertical),Object(O.a)(H,v.Right_Vertical,C.RightVertical),Object(O.a)(H,v.Top_Horizontal,C.TopHorizontal),Object(O.a)(H,v.Bottom_Horizontal,C.BottomHorizontal),H),De=function(e,t,n,o){var r=Math.abs(e-n),c=Math.abs(t-o),a=Math.abs(e-o),i=Math.abs(t-n);return e<n&&t>o||e>n&&e<o&&t<o&&t>n||e<n&&t>n&&t<o||e>n&&e<o&&t>o?0:Math.min(r,c,a,i)},Ge=function(e,t){return function(n,o,r){var c=function(e,t,n,o,r){var c=Object(p.a)(n,2),a=c[0],i=c[1],u=Object(p.a)(o,2),s=u[0],l=u[1],b=Object(p.a)(t,3),f=b[0],g=b[1],m=b[2],O=-1,d=[],j=Math.abs(g[0]-a),v=Math.abs(g[0]-a-s),h=Math.abs(m[1]-i),L=Math.abs(m[1]-i-l),R=-1;return j>-1&&e>j&&(R=De(g[1],m[1],i,i+l))>-1&&R<e&&(O=j,d=[[j,C.LeftVertical,R]]),v>-1&&e>v&&(v<O||O<0)&&(R=De(g[1],m[1],i,i+l))>-1&&R<e&&(O=v,d=[[v,C.RightVertical,R]]),h>-1&&e>h&&(h<O||O<0)&&(R=De(f[0],g[0],a,a+s))>-1&&R<e&&(O=h,d=[[h,C.TopHorizontal,R]]),L>-1&&e>L&&(L<O||O<0)&&(R=De(f[0],g[0],a,a+s))>-1&&R<e&&(O=L,d=[[L,C.BottomHorizontal,R]]),Object(y.a)(d)}(e,t,o.position,o.size);return Object(y.a)(c)}},Ae=[[v.TopLeft,1,v.TopLeft_LeftBottom],[v.TopLeft,2,v.TopLeft_LeftTop],[v.TopLeft,3,v.TopLeft_TopLeft],[v.TopLeft,4,v.TopLeft_TopRight],[v.TopRight,5,v.TopRight_TopLeft],[v.TopRight,6,v.TopRight_TopRight],[v.TopRight,7,v.TopRight_RightTop],[v.TopRight,8,v.TopRight_RightBottom],[v.BottomRight,9,v.BottomRight_RightTop],[v.BottomRight,10,v.BottomRight_RightBottom],[v.BottomRight,11,v.BottomRight_BottomRight],[v.BottomRight,12,v.BottomRight_BottomLeft],[v.BottomLeft,13,v.BottomLeft_BottomRight],[v.BottomLeft,14,v.BottomLeft_BottomLeft],[v.BottomLeft,15,v.BottomLeft_LeftBottom],[v.BottomLeft,16,v.BottomLeft_LeftTop]],Pe=function(e,t){var n=Ae.find(function(n){var o=Object(p.a)(n,3),r=o[0],c=o[1];o[2];return e===r&&t===c});return n?n[2]:v.None},Fe=($e={},Object(O.a)($e,v.TopLeft,(Se={},Object(O.a)(Se,v.TopLeft,v.None),Object(O.a)(Se,v.TopRight,v.LeftTop),Object(O.a)(Se,v.BottomRight,v.TopLeft),Object(O.a)(Se,v.BottomLeft,v.TopLeft),Se)),Object(O.a)($e,v.TopRight,(ke={},Object(O.a)(ke,v.TopLeft,v.RightTop),Object(O.a)(ke,v.TopRight,v.None),Object(O.a)(ke,v.BottomRight,v.TopRight),Object(O.a)(ke,v.BottomLeft,v.RightTop),ke)),Object(O.a)($e,v.BottomLeft,(Ve={},Object(O.a)(Ve,v.TopLeft,v.BottomLeft),Object(O.a)(Ve,v.TopRight,v.LeftBottom),Object(O.a)(Ve,v.BottomRight,v.LeftBottom),Object(O.a)(Ve,v.BottomLeft,v.None),Ve)),Object(O.a)($e,v.BottomRight,(_e={},Object(O.a)(_e,v.TopLeft,v.RightBottom),Object(O.a)(_e,v.TopRight,v.BottomRight),Object(O.a)(_e,v.BottomRight,v.None),Object(O.a)(_e,v.BottomLeft,v.RightBottom),_e)),$e),Je=function(e,t,n,o){return o.filter(function(t){return t.guid!==e}).reduce(function(e,o){var r=function(e,t,n){var o=Object(p.a)(n.position,2),r=o[0],c=o[1],a=Object(p.a)(n.size,2),i=a[0],u=a[1],s=[[r,c],[r+i,c],[r+i,c+u],[r,c+u]].reduce(function(o,r,c){var a=Object(p.a)(r,2),i=a[0],u=a[1],s=[v.TopLeft,v.TopRight,v.BottomRight,v.BottomLeft][c],l=e.reduce(function(e,t,n){var o=t||[0,0],r=Object(p.a)(o,2),c=r[0],a=r[1],s=i-c,l=u-a,b=s*s+l*l,f=[v.TopLeft,v.TopRight,v.BottomRight,v.BottomLeft][n];return t&&(e[0]>b||e[0]<0)?[b,[c,a],f]:e},[-1,[0,0],v.None]),b=Object(p.a)(l,3),f=b[0],g=b[1],m=b[2],O=[s,Object(M.a)({},n,{position:[i,u]})],d=[m,Object(M.a)({},t,{position:[g[0],g[1]]})];return o[0]>f||o[0]<0?[f,Object(M.a)({},d),Object(M.a)({},O),s]:o},[-1,null,null,v.None]),l=Object(p.a)(s,4),b=l[0],f=l[1],g=l[2],m=l[3];return[Math.round(Math.sqrt(b)),f,g,m]}(t,n,o),c=Object(p.a)(r,4),a=c[0],i=c[1],u=c[2],s=c[3],l=i?i[0]:v.None,b=Fe[s]&&Fe[s][l];return e[0]>a||e[0]<0?[a,i,u,b||v.None]:e},[-1,null,null,v.None])},Ue=function(e,t){var n=t.CAPTURE_DELTA,o=t.Indents;return function(t){return function(r,i,u){var s=e(r);return function(e){var r=e.guid,l=e.xy$,b=e.size$,f=Le("magnetable: ".concat(r),i,u),g=Object(c.useRef)(null),m=Object(c.useMemo)(function(){return new ce.a([null,null])},[]),O=Object(c.useContext)(t),d=Object(c.useMemo)(function(){return new ce.a(null)},[]),j=Object(c.useMemo)(function(){return new ce.a(null)},[]);Object(c.useEffect)(function(){console.log("%c storage--\x3e init_magnetable 1: ","color: green; background-color: yellow;",r);var e=O.dragStop.pipe(Object(Te.a)(function(e){return e.elementId!==r})).subscribe(function(e){var t=e.elementId,n=j.getValue();n&&n.magneted===t&&j.next(null)}),t=O.resizeStop.pipe(Object(Te.a)(function(e){return e.elementId!==r})).subscribe(function(e){var t=e.elementId,n=j.getValue();n&&n.magneted===t&&j.next(null)});return function(){e.unsubscribe(),t.unsubscribe()}},[r,O,j]),Object(c.useEffect)(function(){console.log("%c storage--\x3e init_magnetable 2: ","color: green; background-color: yellow;",r);var e=O.magneting.pipe(Object(Te.a)(function(e){return e.direction===R.In&&r===e.items[0]})).subscribe(function(e){var t=e.type,n=e.items,o=l.getValue(),c=b.getValue(),a={frame:[[o[0],o[1]],[c[0],c[1]]],magnetType:t,magneted:n[1],fix:r};j.next(Object(M.a)({},a))});return function(){e.unsubscribe()}},[r,O,l,b,j]);var h=Object(c.useCallback)(function(e,t,c){var a=l.getValue(),i=Object(p.a)(a,2),u=i[0],s=i[1],m=b.getValue(),d=Object(p.a)(m,2),j=d[0],h=d[1],L={guid:r,position:[u,s],size:[j,h]},B=f.get("controls").filter(function(e){return e.guid!==r}).map(function(e){return{guid:e.guid,position:e.position,size:e.size}}),T=[],x=Je(r,c,L,B),E=Object(p.a)(x,4),M=E[0],w=E[1],z=E[2],S=E[3];w&&z&&T.push.apply(T,Object(y.a)(function(e,t){var n=Object(p.a)(t,4),o=n[0],r=n[1],c=n[2],a=n[3];return function(t,n,i,u){var s=i[0],l=Object(p.a)(n[1].size,2),b=l[0],f=l[1],g=n[0],m=i[1],O=m.guid,d=Object(p.a)(m.position,2),j=d[0],h=d[1],L=Object(p.a)(m.size,2),R=L[0],B=L[1],T=Object(p.a)(n[1].position,2),x=T[0],E=T[1];if(t>e)return[];if(s===g)return[];var M=[],w=[v.TopLeft,v.BottomLeft].indexOf(s)>-1?1:0,z=[v.TopLeft,v.TopRight].indexOf(s)>-1?1:0,S=j-w*a+(1-w)*r,k=h-z*o+(1-z)*c,V=0,_=1;(S-x)*(S-x)+(h-E)*(h-E)<(j-x)*(j-x)+(k-E)*(k-E)?V=h:(V=k,_=0);var $=0,I=0,N=s,H=0;switch(g){case v.TopRight:H=z?1:15,H=z||_?H:12*(1-w)+14*w;var C=z?[S-w*b,h]:[_*S+(1-_)*j-b,V],D=Object(p.a)(C,2);$=D[0],I=D[1],M=(N=Pe(s,H))!==v.None?[[O,[$,I],[R,B],N]]:[];break;case v.TopLeft:H=z?8:10;var G=[8,10].indexOf(H=z||_?H:11*(1-w)+13*w)>-1?[S,h]:[j,k],A=Object(p.a)(G,2);$=A[0],I=A[1],M=(N=Pe(s,H))!==v.None?[[O,[$,I],[R,B],N]]:[];break;case v.BottomRight:H=_?16*(1-z)+2*z:5*(1-w)+3*w;var P=_?[S-b,h-f]:[j-b,k-f],F=Object(p.a)(P,2);$=F[0],I=F[1],M=(N=Pe(s,H))!==v.None?[[O,[$,I],[R,B],N]]:[];break;case v.BottomLeft:H=_?9*(1-z)+7*z:6*(1-w)+4*w;var J=_?[S,h-f]:[j,k-f],U=Object(p.a)(J,2);$=U[0],I=U[1],M=(N=Pe(s,H))!==v.None?[[O,[$,I],[R,B],N]]:[]}return Object(y.a)(M)}}(n,o)(M,w,z,S))),!T.length&&g.current&&(O.magneting.next({direction:R.Out,items:[r]}),t()),e(T)},[r,O,b,l,f]),L=Object(c.useCallback)(function(e,t,c){var a=l.getValue(),i=Object(p.a)(a,2),u=i[0],s=i[1],g=b.getValue(),m=Object(p.a)(g,2),d=m[0],j=m[1],h={guid:r,position:[u,s],size:[d,j]},L=f.get("controls").filter(function(e){return e.guid!==r}).map(function(e){return{guid:e.guid,position:e.position,size:e.size}});return function(e,t){return function(n,o,r){return function(n,o){var c=e.reduce(function(e,n,o){var c=Object(p.a)(e,2),a=Object(p.a)(c[0],2),i=a[0],u=a[1],s=c[1],l=Object(p.a)(n,4),b=l[0],f=l[1],g=l[2],m=l[3];if(f!==C.None&&g){var O=-1,d=s[0],j=s[1];if(f!==C.LeftVertical&&f!==C.RightVertical||(d>b||d<0)&&(d=b,O=0),f!==C.TopHorizontal&&f!==C.BottomHorizontal||(j>b||j<0)&&(j=b,O=1),O>-1){var v=t(b,r,[b,f,g,m]);return console.log("%c new nearest: >","color: yellow; background-color: #345; border: 1px solid orange;",b,f,g),0===O?[[v,u],[d,j]]:[[i,v],[d,j]]}}return[[i,u],s]},[[[],[]],[-1,-1]])[0],a=[c[0],c[1]];a[0].length||a[1].length?n(a):o()}}}(function(e,t){var n=Object(p.a)(t,4);return n[0],n[1],n[2],n[3],function(t,n){var o=Ge(e,[t[0],t[1],t[2],t[3]]);return n.reduce(function(e,t,n){var r=o(e,t),c=r.map(function(e){var n=Object(p.a)(e,3),o=n[0],r=n[1],c=n[2];return[o,r,t,c]});return r.length?[].concat(Object(y.a)(e),Object(y.a)(c)):e},[])}}(n,o)(c,L),function(e,t){var n=Object(p.a)(t,4);return n[0],n[1],n[2],n[3],function(t,n,o){var r=Object(p.a)(n.position,2),c=r[0],a=r[1],i=Object(p.a)(n.size,2),u=i[0],s=i[1],l=Object(p.a)(o,4),b=l[0],f=l[1],g=l[2],m=l[3];if(console.log("minDistanceToAnotherEdge",m,g.guid),b<e&&m<e){var O=u,d=s,j=Object(p.a)(g.position,2),h=j[0],L=j[1],R=Object(p.a)(g.size,2),B=R[0],T=R[1],x=h-c,E=L-a;switch(f){case C.LeftVertical:var M=x>50?[x,s]:[u,s],y=Object(p.a)(M,2);O=y[0],d=y[1];break;case C.RightVertical:var w=x+B>50?[x+B,s]:[u,s],z=Object(p.a)(w,2);O=z[0],d=z[1];break;case C.TopHorizontal:var S=E>50?[u,E]:[u,s],k=Object(p.a)(S,2);O=k[0],d=k[1];break;case C.BottomHorizontal:var V=E+T>50?[u,E+T]:[u,s],_=Object(p.a)(V,2);O=_[0],d=_[1];break;default:O=u,d=s}return[[g.guid,[O,d],g.size,He[f]||v.None]]}return[]}}(n,o))(r,O,h)(e,t)},[r,O,f,l,b]);return Object(c.useEffect)(function(){console.log("%c \nstart subs nearest >\n","background-color: #111; color: white; border: 1px solid orange;");var e=O.magneting.pipe(Object(Te.a)(function(e){var t=e.direction===R.Out,n=O.magneted.getValue(),o=t&&!!n.filter(function(e){return e.magneted.includes(r)}).length;return t&&console.log("%c outing-item ---\x3e","color: yellow; background-color: black; border: orange;",o,r,n,e),o})).subscribe(function(e){console.log("---\n\n outing-item MAGNETING_SUB->",e,r,j.getValue(),d.getValue()),g.current=null,j.next(null),d.next(null)}),t=O.dragStop.pipe(Object(Te.a)(function(e){return e.elementId===r})).subscribe(function(e){if(console.log("stop listening ->",r,g.current,O.group.getValue()),g.current){var t=Object(p.a)(g.current,1),n=Object(p.a)(t[0],2),o=n[0],c=n[1];g.current=null,j.next(null),f.send("position",[r,[o,c]]),d.next([[o,c],1])}}),n=O.dragStart.pipe(Object(Te.a)(function(e){return e.elementId===r})).subscribe(function(e){O.magnetingStart.next(r),O.magneting.next({direction:R.Out,items:[r]})}),o=O.drag.pipe(Object(Te.a)(function(e){var t=e.elementId;return t===r&&O.group.getValue().findIndex(function(e){return e===t})<0})).subscribe(function(e){var t=l.getValue(),n=Object(p.a)(t,2),o=n[0],c=n[1],a=b.getValue(),i=Object(p.a)(a,2),u=i[0],s=i[1];h(function(e){e.forEach(function(e){var t=Object(p.a)(e,4),n=t[0],o=t[1],c=(t[2],t[3]);g.current&&g.current[1]===c||(O.magneted.getValue().length&&O.magneting.next({direction:R.Out,items:[r]}),O.magneting.next({direction:R.In,items:[n,r],type:c}),g.current=[[o[0],o[1]],c],d.next([[o[0],o[1]],0]))})},function(){g.current=null,j.next(null),d.next(null)},[[o,c],[o+u,c],[o+u,c+s],[o,c+s]])}),c=O.resizeStart.pipe(Object(Te.a)(function(e){return e.elementId===r})).subscribe(function(e){O.magnetingStart.next(r),O.magneting.next({direction:R.Out,items:[r]})}),a=O.resizeStop.pipe(Object(Te.a)(function(e){return e.elementId===r})).subscribe(function(e){var t=m.getValue(),n=Object(p.a)(t,2),o=n[0],c=n[1];if(console.log("resizing stop! ->",r,o,c),o||c){var a=b.getValue(),i=[o,c].map(function(e){return e?[Ce[e[3]]||C.None,e[1]]:[C.None,[-1,-1]]}),u=i.reduce(function(e,t){var n=Object(p.a)(t,2),o=n[0],r=Object(p.a)(n[1],2),c=r[0],a=r[1];return[o===C.LeftVertical||o===C.RightVertical?c:e[0],o===C.TopHorizontal||o===C.BottomHorizontal?a:e[1]]},[-1,-1]),s=Object(p.a)(u,2),l=s[0],g=s[1],O=l>-1?l:a[0],v=g>-1?g:a[1];b.next([O,v]),f.send("size",[r,[O,v]]),m.next([null,null]),j.next(null),d.next(null)}}),i=O.resize.pipe(Object(Te.a)(function(e){return Object(p.a)(e,1)[0]===r})).subscribe(function(e){Object(p.a)(e,1)[0];var t=l.getValue(),n=Object(p.a)(t,2),o=n[0],c=n[1],a=b.getValue(),i=Object(p.a)(a,2),u=i[0],s=i[1];L(function(e){var t=m.getValue(),n=Object(p.a)(t,2),o=n[0],c=n[1],a=Object(p.a)(e,2),i=a[0],u=a[1],s=o,l=c,b=0,f=o&&!!i.filter(function(e){var t=Object(p.a)(e,4),n=t[0],r=(t[1],t[2],t[3]);return n===o[0]&&r!==o[3]||n!==o[0]}).length;f&&console.log("isNewVert",f,[o,c],[i&&i[0],u&&u[0]]),(o&&!i.length||!o&&i.length||f)&&(b=1,s=i[0]);var g=c&&!!u.filter(function(e){var t=Object(p.a)(e,4),n=t[0],o=(t[1],t[2],t[3]);return n===c[0]&&o!==c[3]||n!==c[0]}).length;(c&&!u.length||!c&&u.length||g)&&(b=3-b,l=u[0]),b&&(m.next([s||null,l||null]),(s||l)&&((o||c)&&O.magneting.next({direction:R.Out,items:[r]}),[s,l].filter(function(e){return!!e}).reduce(function(e,t){var n=Object(p.a)(t,4),o=n[0],r=(n[1],n[2],n[3]);return e.findIndex(function(e){var t=Object(p.a)(e,2),n=t[0],c=t[1];return n===o&&c===r})>-1?Object(y.a)(e):[].concat(Object(y.a)(e),[[o,r]])},[]).forEach(function(e){var t=Object(p.a)(e,2),n=t[0],o=t[1];return O.magneting.next({direction:R.In,items:[n,r],type:o})}),d.next([[-1,-1],0])))},function(){var e=m.getValue(),t=Object(p.a)(e,2),n=t[0],o=t[1];if(n||o){var r=n?[n[0]]:[];o&&!r.filter(function(e){return e&&e[0]===o[0]}).length&&r.push(o[0]),r.forEach(function(e){return O.magneting.next({direction:R.Out,items:[e]})}),g.current=null,j.next(null),m.next([null,null]),d.next(null)}},[[o,c],[o+u,c],[o+u,c+s],[o,c+s]])});return function(){e.unsubscribe(),o.unsubscribe(),n.unsubscribe(),t.unsubscribe(),i.unsubscribe(),c.unsubscribe(),a.unsubscribe()}},[r,O,f,l,b,d,j,g,m,L,h]),a.a.createElement(s,Object.assign({},e,{markerPosition$:d,nearestFrame$:j}),e.children)}}}}(function(e){return function(t){var n=t.guid,o=t.position$,r=t.xy$,i=t.markerPosition$,u=t.size$,s=t.nearestFrame$,l=Object(c.useState)(i.getValue()),b=Object(p.a)(l,2),f=b[0],g=b[1],m=he(u),O=Object(p.a)(m,1)[0],d=he(s),j=Object(p.a)(d,1)[0];Object(c.useEffect)(function(){var e=i.subscribe(function(e){e&&1===e[1]&&r.next([e[0][0],e[0][1]]),g(e)});return function(){return e.unsubscribe()}},[n,i,r,o]);var h=[v.Left_Vertical,v.Right_Vertical,v.Top_Horizontal,v.Bottom_Horizontal],L=j&&h.indexOf(j.magnetType)<0,R=j&&h.indexOf(j.magnetType)>-1;return a.a.createElement(a.a.Fragment,null,a.a.createElement(q,{size:[O[0],O[1]],markerPosition:f}),R&&a.a.createElement(J,{type:j?j.magnetType:null,offset:0,indent:[30,50,30,50]}),R&&a.a.createElement(J,{type:j?j.magnetType:null,offset:1,indent:[30,50,30,50]}),L&&a.a.createElement(J,{type:j?j.magnetType:null,indent:[30,50,30,50]}),a.a.createElement(e,t,t.children))}},{CAPTURE_DELTA:80,Indents:[30,50,30,50]}),We={resize:new re.a,resizeStart:new re.a,resizeStop:new re.a},qe=function(e){return[e]},Xe=[Object(M.a)({},We),function(e){return[(t=e,function(){var e=t.resizeStart.pipe(Object(ie.a)(function(e){var t=e.elementId;return console.log("start resize!",t)}),Object(ie.a)(function(e){var n=e.elementId;return t.control.next(n)}),Object(se.a)(function(e){return Object(ae.a)(new ce.a(e),t.mouseMove).pipe(Object(le.a)(t.mouseStop.pipe(Object(ie.a)(function(e){var n=e.ev,o=t.control.getValue();t.resizeStop.next({elementId:o,ev:n,type:h.StopResize}),t.control.next(null)}))))})).subscribe(function(e){var n=Object(p.a)(e,2),o=n[0],r=n[1],c=[o.ev.clientX,o.ev.clientY],a=c[0],i=c[1];t.resize.next([o.elementId,[r.ev.clientX-a,r.ev.clientY-i]])});return function(){e.unsubscribe()}}),qe(e)];var t}],Ye=function(e){return function(t){return function(n,o,r){var i=e(n,t);return function(e){var n=e.guid,u=e.activeLevel$,s=e.size$,l=Le("resizable: ".concat(n),o,r),b=Object(c.useContext)(t),f=Object(c.useRef)(s.getValue());return Object(c.useEffect)(function(){var e=b.resizeStart.pipe(Object(Te.a)(function(e){return e.elementId===n})).subscribe(function(e){var t=s.getValue(),n=Object(p.a)(t,2),o=n[0],r=n[1];f.current=[o,r]}),t=b.resize.pipe(Object(Te.a)(function(e){var t=Object(p.a)(e,1)[0];return n===t})).subscribe(function(e){var t=Object(p.a)(e,2),o=(t[0],t[1]),r=Object(p.a)(o,2),c=r[0],a=r[1],i=f.current[0]+c,u=f.current[1]+a;if(i>60||u>60){var b=s.getValue(),g=Object(p.a)(b,2),m=g[0],O=g[1],d=i>60?i:m,j=u>60?u:O;l.send("size",[n,[d,j]]),s.next([d,j])}});return function(){console.log("subscription unsub!",n),t.unsubscribe(),e.unsubscribe()}},[n,b,l,u,f,s]),a.a.createElement(i,e,e.children)}}}}(function(e,t){return function(n){var o=n.guid,r=n.activeLevel$,i=n.handlers,u=Object(c.useContext)(t),s=he(r),l=Object(p.a)(s,1)[0],b=Object(c.useMemo)(function(){return i?Object(M.a)({},i,{onMouseDown:function(){}}):{onMouseDown:function(){}}},[i]),f=Object(c.useMemo)(function(){return{onMouseDown:function(e){e.stopPropagation(),u.resizeStart.next({elementId:o,ev:e.nativeEvent,type:h.Resize})}}},[o,u]),g=Object(c.useMemo)(function(){return"root"===o?i:b},[o,i,b]),m=l?["resizer","active"]:["resizer"];return a.a.createElement(e,Object.assign({},n,{handlers:g}),n.children,(l===d.Hover||l===d.HoverInGroup)&&a.a.createElement(E,Object.assign({},n,{handlers:Object(M.a)({},f),classModifiers:[].concat(m)})))}}),Ke=n(467),Qe={lasso:new re.a,trapping:new re.a},Ze=function(e){return[e]},et=[Object(M.a)({},Qe),function(e){return[(t=e,function(){var e=t.dragStart.pipe(Object(ie.a)(function(e){return"selecting-frame"===e.elementId&&t.group.next([])}),Object(se.a)(function(e){return t.trapping.pipe(Object(Ke.a)(function(e,t){var n=Object(p.a)(t,1)[0],o=e.filter(function(e){return n&&e.guid===n.guid}).length?[]:[n];return n&&n.trappedType===L.In?[].concat(Object(y.a)(e),o):e.filter(function(e){return n&&e.guid!==n.guid})},[]),Object(ie.a)(function(e){return t.group.next(e.map(function(e){return e.guid}))}),Object(le.a)(t.mouseStop))})).subscribe(function(e){});return function(){e.unsubscribe()}}),Ze(e)];var t}],tt=function(e){return function(t){return function(n){var o=e(n);return function(e){var n=e.activeLevel$,r=e.guid,i=e.xy$,u=e.position$,s=e.size$,l=Object(c.useRef)(n.getValue()),b=Object(c.useRef)([0,0]),f=Object(c.useState)(!1),g=Object(p.a)(f,2),m=g[0],O=g[1],j=Object(c.useRef)(m),v=Object(c.useRef)(!1),R=Object(c.useContext)(t);Object(c.useEffect)(function(){var e=R.mouseDown.pipe(Object(Te.a)(function(e){var t=e.elementId;return j.current&&("selecting-frame"===t||!R.group.getValue().includes(t))&&R.group.getValue().includes(r)})).subscribe(function(e){var t=e.ev;v.current=!1,R.dragStop.next({elementId:r,ev:t,type:h.StopDrag}),R.group.next(R.group.getValue().filter(function(e){return e!==r})),j.current=!1,n.next(d.None),O(!1)});return function(){e.unsubscribe()}},[r,R,n,j,v]),Object(c.useEffect)(function(){var e=R.mouseStop.pipe(Object(Te.a)(function(e){return v.current&&j.current&&R.group.getValue().includes(r)})).subscribe(function(e){var t=e.ev;v.current=!1,R.dragStop.next({elementId:r,ev:t,type:h.StopDrag})});return function(){e.unsubscribe()}},[r,R,j,v]),Object(c.useEffect)(function(){var e=R.mouseDown.pipe(Object(Te.a)(function(e){var t=e.elementId;return j.current&&"selecting-frame"!==t&&R.group.getValue().includes(t)}),Object(ie.a)(function(e){return b.current=i.getValue()}),Object(ie.a)(function(e){var t=e.ev,n=e.elementId;v.current||(v.current=!0),r!==n&&R.dragStart.next({elementId:r,ev:t,type:h.DragInGroup})}),Object(se.a)(function(e){var t=e.elementId;return R.deltaMoves.pipe(Object(Te.a)(function(e){var n=Object(p.a)(e,2),o=n[0];return n[1],o===t&&o===r}),Object(le.a)(R.dragStop.pipe(Object(Te.a)(function(e){return e.elementId===r}))))})).subscribe(function(e){var t=Object(p.a)(e,2),n=(t[0],t[1]),o=Object(p.a)(b.current,2),c=o[0],a=o[1];i.next([c+n[0],a+n[1]]),R.group.getValue().forEach(function(e){return e!==r&&R.deltaMoves.next([e,n])})});return function(){e.unsubscribe()}},[r,R,b,i,u,n,j,v]),Object(c.useEffect)(function(){var e=R.lasso.subscribe(function(e){var t=e.end,o=e.start,c=(e.trapped,i.getValue()),a=s.getValue(),u=[c[0]+a[0],c[1]+a[1]],b=o[0]<c[0]&&t[0]>u[0];if((b=b&&o[1]<c[1]&&t[1]>u[1])!==j.current&&(t[0]||t[1]||o[0]||o[1])){b&&R.trapping.next([{guid:r,trappedType:L.In}]),!b&&R.trapping.next([{guid:r,trappedType:L.Out}]),j.current=b;var f=n.getValue();b?(l.current=n.getValue(),f=(f=f===d.None?d.InGroup:f)===d.Hover?d.HoverInGroup:f):f=l.current,n.next(f),O(b)}});return function(){e.unsubscribe()}},[r,R,i,s,n,l,j]);var B=e.classModifiers||[],T=m?[].concat(Object(y.a)(B),["in-lasso-trapped"]):Object(y.a)(B);return a.a.createElement(o,Object.assign({},e,{classModifiers:T}),e.children)}}}},nt=Re(K),ot=tt(function(e){return function(t){var n=Object(c.useMemo)(function(){return new ce.a([0,0])},[]);return a.a.createElement(nt,Object.assign({},t,{position$:n}),a.a.createElement(e,t,t.children))}}),rt=a.a.createContext(null),ct=be(rt,[Xe,ze,et]),at=Me(Ee)(rt,function(e,t){return{onMouseDown:function(n){if(n.stopPropagation(),n.button===B.Left){var o=n.ctrlKey?"selecting-frame":e;t.control.next(o),console.log("start on mouseDown",o),t.mouseDown.next({ev:n.nativeEvent,type:n.ctrlKey?h.StartSelecting:h.StartDrag,elementId:o})}},onMouseUp:function(e){}}}),it=Ue(rt),ut=Ye(rt),st=ot(rt),lt=(Ie=rt,function(e){return function(t){var n=t.size$,o=t.position$,r=t.offsetPosition$,i=Object(c.useContext)(Ie),u=Object(c.useRef)([0,0]),s=Object(c.useRef)([]),l=Object(c.useMemo)(function(){return new ce.a(n.getValue())},[n]),b=Object(c.useMemo)(function(){return new ce.a([0,0])},[]),f=Object(c.useMemo)(function(){return new ce.a([0,0])},[]);return Object(c.useEffect)(function(){console.log("%c init sub in Lasso ","background-color: yellow; color: red; border: 1px solid black;");var e=i.dragStart.pipe(Object(Te.a)(function(e){return"selecting-frame"===e.elementId}),Object(ie.a)(function(e){var t=e.ev,n=r.getValue(),c=Object(p.a)(n,2),a=c[0],i=c[1];console.log("offsetPosition$",[a,i]),u.current=[t.clientX-a,t.clientY-i],o.next([t.clientX-a,t.clientY-i])}),Object(se.a)(function(e){return i.deltaMoves.pipe(Object(le.a)(i.dragStop.pipe(Object(ie.a)(function(e){u.current=[0,0],o.next([0,0]),l.next([0,0]),i.lasso.next({start:[0,0],end:[0,0],trapped:[]})}))))})).subscribe(function(e){var t=Object(p.a)(e,2),n=(t[0],t[1]),r=Object(p.a)(n,2),c=r[0],a=r[1],s=Object(p.a)(u.current,2),b=s[0],f=s[1],g=b,m=f,O=c,d=a;c<0&&(O=-c,g=b+c),a<0&&(d=-a,m=f+a),(c<0||a<0)&&o.next([g,m]),l.next([O,d]),i.lasso.next({start:[g,m],end:[g+O,m+d],trapped:[]})});return function(){console.log("%c unsub in selectable lasso: handlers ","color: yellow; background-color: brown;"),e.unsubscribe()}},[i,f,l,o,r,u,s]),a.a.createElement(e,Object.assign({},t,{size$:l,xy$:f,position$:b,classModifiers:["selectable"],classBlocks:["block"],classElements:["selecting-frame"]}),t.children)}}),bt=(ee.getBlock(r.Container),ct(_)),ft=function(e){return c.createElement(bt,Object.assign({},e,{guid:"root",classModifiers:["silver-bordered","relative-hidden"]}),e.children)},gt=(n(458),ee.getBlock(r.Container)),mt=function(e){var t=e.xy,n=e.size;return a.a.createElement(gt,Object.assign({},e,{classModifiers:e.classModifiers?["orange-bordered"].concat(Object(y.a)(e.classModifiers)):["orange-bordered"]}),a.a.createElement("div",{className:"content-wrapper",style:e.style},a.a.createElement("div",{style:{fontSize:"14px"}},e.name)),e.children,a.a.createElement("div",{style:{fontSize:"12px",position:"absolute",bottom:2,right:2}},a.a.createElement("div",null,"sx=",n[0]),a.a.createElement("div",null,"sy= ",n[1])),a.a.createElement("div",{style:{fontSize:"12px",position:"absolute",bottom:2,left:2}},a.a.createElement("div",null,"x=",t[0]),a.a.createElement("div",null,"y= ",t[1])))},pt=[["position",function(e){return function(t){var n=Object(p.a)(t,2),o=n[0],r=n[1];e.state.controls$.next(e.state.controls$.getValue().map(function(e){return e.guid===o?Object(M.a)({},e,{position:[r[0],r[1]]}):Object(M.a)({},e)}))}}],["size",function(e){return function(t){var n=Object(p.a)(t,2),o=n[0],r=n[1];e.state.controls$.next(e.state.controls$.getValue().map(function(e){return e.guid===o?Object(M.a)({},e,{size:[r[0],r[1]]}):Object(M.a)({},e)}))}}]],Ot=[["controls",function(e){return function(){return e.state.controls$.getValue()}}]],dt=ee.getBlock(r.Box),jt=at(it(st(ut(Be(function(e){return a.a.createElement(dt,e,a.a.createElement(mt,Object.assign({},e,{position:[0,0]})))}),pt,[])),pt,Ot),pt,[]),vt=function(e){var t=e.component,n=e.controls$,o=Object(c.useState)([]),r=Object(p.a)(o,2),i=r[0],u=r[1];return Object(c.useEffect)(function(){var e=n.pipe().subscribe(function(e){u(Object(y.a)(e))});return function(){return e.unsubscribe()}},[n]),a.a.createElement(c.Fragment,null,i.map(function(e){return a.a.createElement(t,Object.assign({key:"".concat(e.guid,"-").concat(e.name)},e))}))},ht=a.a.memo(jt),Lt=function(e){var t=e.offsetPosition$,n=Object(c.useRef)([]),o=Le("stored-workspace",n.current,Ot),r=Object(c.useMemo)(function(){return new ce.a([])},[]);return Object(c.useEffect)(function(){var e=t.getValue(),n=Object(p.a)(e,2),c=n[0],a=n[1],i=o.get("controls");r.next(i.map(function(e){return{guid:e.guid,name:"".concat(e.uiType,"-").concat(e.guid),activeLevel$:new ce.a(d.None),xy$:new ce.a([e.position[0],e.position[1]]),position$:new ce.a([e.position[0],e.position[1]]),size$:new ce.a([e.size[0],e.size[1]]),style:e.style,offsetPosition$:new ce.a([c,a])}}))},[o,r,t]),a.a.createElement(vt,{component:ht,controls$:r,offsetPosition$:new ce.a([0,0])})},Rt=[],Bt=[["observerable-data",function(e){return function(){return e.state.root$}}]],Tt=at(lt(Re(ee.getBlock(r.Box))),Rt,[]),xt=function(e){var t=e.offsetPosition$,n=Le("root-for-lasso",Rt,Bt),o=Object(c.useMemo)(function(){return new ce.a(d.None)},[]),r=Object(c.useMemo)(function(){return new ce.a([0,0])},[]),i=Object(c.useMemo)(function(){return new ce.a([0,0])},[]),u=Object(c.useMemo)(function(){return new ce.a([0,0])},[]);return Object(c.useEffect)(function(){console.log("%c init effect inside result-lasso ","color: red; background-color: silver;");var e=t.getValue(),o=Object(p.a)(e,2),r=o[0],c=o[1],a=n.get("observerable-data").subscribe(function(e){var n=e.position;return t.next([r+n[0],c+n[1]])});return function(){return a.unsubscribe()}},[n,t]),a.a.createElement(Tt,{guid:"selecting-frame",activeLevel$:o,offsetPosition$:t,position$:r,xy$:i,size$:u})},Et=[["position",function(e){return function(t){var n=Object(p.a)(t,2),o=(n[0],n[1]),r=e.state.root$.getValue();e.state.root$.next(Object(M.a)({},r,{position:[o[0],o[1]]}))}}],["size",function(e){return function(t){var n=Object(p.a)(t,2),o=(n[0],n[1]),r=e.state.root$.getValue();e.state.root$.next(Object(M.a)({},r,{size:[o[0],o[1]]}))}}]],Mt=[["data",function(e){return function(){return e.state.root$.getValue()}}]],yt=Be(oe),wt=at(ut(function(e){return a.a.createElement(yt,e,a.a.createElement(Lt,{offsetPosition$:e.offsetPosition$}),a.a.createElement(xt,{offsetPosition$:e.offsetPosition$}),e.children)},Et,[]),Et,[]),zt=function(){var e=Object(c.useRef)([]),t=Le("stored-workspace",e.current,Mt),n=Object(c.useState)(null),o=Object(p.a)(n,2),r=o[0],i=o[1],u=Object(c.useState)(null),s=Object(p.a)(u,2),l=s[0],b=s[1],f=Object(c.useRef)(null);Object(c.useEffect)(function(){if(r&&!f.current){var e=r.getBoundingClientRect();f.current=[e.left,e.top],console.log("cntRef effect!",f.current),b([e.left,e.top])}},[r,f]),Object(c.useEffect)(function(){return function(){console.log("destroy workspace!")}},[]);var g=t.get("data"),m=g.size,O=g.position;return console.log("%c render inside workspace","color: yellow; background-color: red"),a.a.createElement(ft,{setRef:i},l&&a.a.createElement(wt,{xy$:new ce.a([O[0],O[1]]),position$:new ce.a([O[0],O[1]]),size$:new ce.a([m[0],m[1]]),activeLevel$:new ce.a(d.None),offsetPosition$:new ce.a([l[0],l[1]]),guid:"root"}))};!function(e){e.Root="root",e.CircleBlock="circle",e.RectangleBlock="rectangle",e.ConditionBlock="condition",e.TimerBlock="timer"}(Ne||(Ne={}));var St=Object(O.a)({},Ne.RectangleBlock,{backgroundColor:"#213c58"}),kt=Object(y.a)(new Array(4).fill(0).map(function(e,t){return{guid:"test-".concat(t),classType:"testClass",uiType:Ne.RectangleBlock,position:[Math.round(450*Math.random()+20*t),Math.round(250*Math.random()+20*t)],size:[Math.round(150*Math.random()+80),Math.round(90*Math.random()+70)],style:St[Ne.RectangleBlock]}})),Vt={guid:"root",classType:"Root",position:[10,10],size:[700,500],uiType:Ne.Root},_t={controls$:new ce.a(Object(y.a)(kt)),root$:new ce.a(Object(M.a)({},Vt))},$t=function(){var e=[new Oe(_t,[]),de.Provider],t=Object(p.a)(e,2),n=t[0],o=t[1];return a.a.createElement(o,{value:n},a.a.createElement(zt,null))},It=(n(459),g($t)),Nt=function(){return a.a.createElement("div",{className:"App"},a.a.createElement(m,{title:"Designer"},a.a.createElement(s.b,{activeClassName:"link-item--active",exact:!0,activeStyle:{color:"orange"},to:"/"},"Home")," \\\\",a.a.createElement(s.b,{activeClassName:"link-item--active",activeStyle:{color:"orange"},to:"/about"},"About")," \\\\",a.a.createElement(s.b,{activeClassName:"link-item--active",activeStyle:{color:"orange"},to:"/workspace"},"Workspace")),a.a.createElement(It,null))},Ht=function(){u.a.render(a.a.createElement(s.a,{basename:"#"},a.a.createElement(Nt,null)),document.getElementById("root"))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));Ht(),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[226,1,2]]]);
//# sourceMappingURL=main.d2180c90.chunk.js.map