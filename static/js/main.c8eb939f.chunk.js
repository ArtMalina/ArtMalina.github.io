(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{226:function(e,t,n){n(227),e.exports=n(461)},450:function(e,t,n){},455:function(e,t,n){},456:function(e,t,n){},457:function(e,t,n){},458:function(e,t,n){},459:function(e,t,n){},460:function(e,t,n){},461:function(e,t,n){"use strict";n.r(t);var o,r,c=n(0),a=n.n(c),i=n(221),u=n.n(i),s=(n(450),n(71)),l=n(57),f=function(e){return a.a.createElement("div",{className:"container"},"Home!")},b=function(e){return a.a.createElement("div",{className:"container"},"About!")},g=function(e){return function(){return a.a.createElement("div",{className:"container content-box"},a.a.createElement(l.c,null,a.a.createElement(l.a,{exact:!0,path:"/",component:f}),a.a.createElement(l.a,{exact:!0,path:"/about",component:b}),a.a.createElement(l.a,{exact:!0,path:"/workspace",component:e})))}},m=(n(455),function(e){return a.a.createElement("nav",null,a.a.createElement("div",{className:"flex-item"},a.a.createElement("h1",null,e.title)),a.a.createElement("div",{className:"links-container"},a.a.Children.map(e.children,function(e){return a.a.createElement("div",{className:"link-item"},e)})))}),p=n(1),d=n(4);!function(e){e.HTML="<HTML>",e.SVG="<SVG>",e.CANVAS_2D="CANVAS_2D",e.WEBGL="WEBGL"}(o||(o={})),function(e){e.Anchor="Anchor",e.Box="Box",e.Container="Container",e.DragFrame="DragFrame",e.MagnetCornerFrame="MagnetCornerFrame",e.MagnetBorderFrame="MagnetBorderFrame",e.SelectedFrame="SelectedFrame"}(r||(r={}));n(456);var O,j,v,h,L,x,B,R=function(e){var t=e.handlers||{},n=e.classModifiers||[],o=e.icon;return a.a.createElement("div",Object.assign({},t,{className:"block_anchor".concat(n.length?" "+n.map(function(e){return"block_anchor--".concat(e)}).join(" "):""),style:{marginLeft:0,marginTop:0}}),o)},T=[[o.HTML,R]],E=R,M=n(3),y=n(5),w=(n(457),function(e){var t=e.classModifiers||[],n=e.classBlocks||[],o=e.classElements||[],r=e.handlers||{},c=Object(y.a)(t).map(function(e){return"block--".concat(e)}).join(" "),i=n[0]||"",u=Object(y.a)(o).map(function(e){return i&&"".concat(i,"_").concat(e)}).join(" "),s=e.style||{};return a.a.createElement("div",Object.assign({},r,{className:"box-item box-item--div".concat(i?" "+i:"").concat(c?" "+c:"").concat(u?" "+u:""),style:Object(M.a)({left:e.position[0],top:e.position[1],width:e.size[0],height:e.size[1]},s)}),e.children)}),k=[[o.HTML,w]],z=w,S=(n(458),function(e){var t=e.classModifiers||[],n=e.handlers||{},o=e.style||{},r=t.map(function(e){return"block--".concat(e)}).join(" "),i=Object(c.useRef)(null);return Object(c.useEffect)(function(){i.current&&e.setRef&&e.setRef(i.current)},[i,e]),a.a.createElement("div",Object.assign({},n,{ref:i,className:"container block ".concat(r),style:Object(M.a)({},o)}),e.children)}),V=[[o.HTML,S]],_=S;!function(e){e.None="<none>",e.Hover="<hover>",e.InGroup="<in-group>",e.HoverInGroup="<hover-in-group>",e.JustMove="<just-move(?)>",e.MoveByHand="<move-by-hand>",e.MoveByHandInGroup="<move-by-hand-in-group>",e.MoveInGroup="<move-in-group>"}(O||(O={})),function(e){e[e.None=0]="None",e[e.JustMove=1]="JustMove",e[e.JustActive=2]="JustActive",e[e.InGroup=3]="InGroup",e[e.MoveAndSelect=4]="MoveAndSelect",e[e.MoveInGroup=5]="MoveInGroup",e[e.Resize=6]="Resize"}(j||(j={})),function(e){e.TopLeft="<TopLeft>",e.TopLeft_TopLeft="<TopLeft-TopLeft>",e.TopLeft_TopRight="<TopLeft-TopRight>",e.TopLeft_LeftTop="<TopLeft-LeftTop>",e.TopLeft_LeftBottom="<TopLeft-LeftBottom>",e.TopRight="<TopRight>",e.TopRight_TopLeft="<TopRight-TopLeft>",e.TopRight_TopRight="<TopRight-TopRight>",e.TopRight_RightTop="<TopRight-RightTop>",e.TopRight_RightBottom="<TopRight-RightBottom>",e.BottomRight="<BottomRight>",e.BottomRight_RightTop="<BottomRight-RightTop>",e.BottomRight_RightBottom="<BottomRight-RightBottom>",e.BottomRight_BottomRight="<BottomRight-BottomRight>",e.BottomRight_BottomLeft="<BottomRight-BottomLeft>",e.BottomLeft="<BottomLeft>",e.BottomLeft_BottomRight="<BottomLeft-BottomRight>",e.BottomLeft_BottomLeft="<BottomLeft-BottomLeft>",e.BottomLeft_LeftBottom="<BottomLeft-LeftBottom>",e.BottomLeft_LeftTop="<BottomLeft-LeftTop>",e.Left_Vertical="<left-vertical>",e.Right_Vertical="<right-vertical>",e.Top_Horizontal="<top-horizontal>",e.Bottom_Horizontal="<bottom-horizontal>",e.RightTop="<RightTop>",e.RightBottom="<RightBottom>",e.LeftTop="<LeftTop>",e.LeftBottom="<LeftBottom>",e.None="<None>"}(v||(v={})),function(e){e.StartDrag="StartDrag",e.DragInGroup="DragInGroup",e.Move="Move",e.Resize="Resize",e.StopResize="StopResize",e.StopDrag="StopDrag",e.Cancel="Cancel",e.StartSelecting="StartSelecting",e.StopSelecting="StopSelecting"}(h||(h={})),function(e){e[e.In=1]="In",e[e.Out=-1]="Out"}(L||(L={})),function(e){e[e.In=1]="In",e[e.Out=-1]="Out"}(x||(x={})),function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"}(B||(B={}));var $,I,N,H,C,D=function(e){var t=e.size,n=e.activeLevel,o=n!==O.None&&n!==O.InGroup,r=o?20:0,c=-r/2,i=-r/2,u={width:t[0]+r,height:t[1]+r,marginLeft:c,marginTop:i,borderWidth:4,padding:o?r/2-4:0};console.log("drag base frame",e);var s=e.classModifiers?e.classModifiers.map(function(e){return"block_frame--".concat(e)}).join(" "):"";return a.a.createElement("div",{className:"block_frame block_frame--".concat(o?"drag":"no-drag").concat(s?" "+s:""),style:u},o&&a.a.createElement("div",{className:"block_frame__border--crop",style:{position:"absolute",marginLeft:c,marginTop:r/2,width:t[0]+r/2+2,height:t[1]-r,borderWidth:4,borderStyle:"none solid"}}),o&&a.a.createElement("div",{className:"block_frame__border--crop",style:{position:"absolute",marginTop:i,marginLeft:r/2,height:t[1]+r/2+2,width:t[0]-r,borderWidth:4,borderStyle:"solid none"}}),e.children)},G=[[o.HTML,D]],A=D,P=function(e){var t=e.type,n=e.indent,o=e.offset,r=null!==t?function(e,t,n){var o=Object(p.a)(t,4),r=o[0],c=o[1],a=o[2],i=o[3],u={width:20,height:20},s={borderTopStyle:"solid",borderLeftStyle:"solid"},l={borderTopStyle:"solid",borderRightStyle:"solid"},f={borderBottomStyle:"solid",borderLeftStyle:"solid"},b={borderBottomStyle:"solid",borderRightStyle:"solid"},g={borderColor:"lime"},m=n?{borderLeftStyle:"solid"}:{borderRightStyle:"solid"},d=n?{borderBottomStyle:"solid"}:{borderTopStyle:"solid"},O={};switch(e){case v.TopLeft_LeftBottom:u=Object(M.a)({},u,l,{left:-i-20,top:0});break;case v.TopLeft_LeftTop:u=Object(M.a)({},u,b,{left:-i-20,top:-20});break;case v.TopLeft_TopLeft:u=Object(M.a)({},u,b,{left:-20,top:-r-20});break;case v.TopLeft_TopRight:u=Object(M.a)({},u,f,{left:0,top:-r-20});break;case v.TopRight_TopLeft:u=Object(M.a)({},u,b,{right:0,top:-r-20});break;case v.TopRight_TopRight:u=Object(M.a)({},u,f,{right:-20,top:-r-20});break;case v.TopRight_RightTop:u=Object(M.a)({},u,f,{right:-c-20,top:-20});break;case v.TopRight_RightBottom:u=Object(M.a)({},u,s,{right:-c-20,top:0});break;case v.BottomRight_RightTop:u=Object(M.a)({},u,f,{right:-c-20,bottom:0});break;case v.BottomRight_RightBottom:u=Object(M.a)({},u,s,{right:-c-20,bottom:-20});break;case v.BottomRight_BottomRight:u=Object(M.a)({},u,s,{right:-20,bottom:-a-20});break;case v.BottomRight_BottomLeft:u=Object(M.a)({},u,l,{right:0,bottom:-a-20});break;case v.BottomLeft_BottomRight:u=Object(M.a)({},u,s,{left:0,bottom:-a-20});break;case v.BottomLeft_BottomLeft:u=Object(M.a)({},u,l,{left:-20,bottom:-a-20});break;case v.BottomLeft_LeftBottom:u=Object(M.a)({},u,l,{left:-i-20,bottom:-20});break;case v.BottomLeft_LeftTop:u=Object(M.a)({},u,b,{left:-i-20,bottom:0});break;case v.Left_Vertical:O=n?{width:1,top:5-r}:{width:1,bottom:5-a},u=Object(M.a)({},u,g,m,{left:0},O);break;case v.Right_Vertical:O=n?{width:1,top:5-r}:{width:1,bottom:5-a},u=Object(M.a)({},u,g,m,{right:0},O);break;case v.Top_Horizontal:O=n?{height:1,left:5-i}:{height:1,right:5-c},u=Object(M.a)({},u,g,d,{top:0},O);break;case v.Bottom_Horizontal:O=n?{height:1,left:5-i}:{height:1,right:5-c},u=Object(M.a)({},u,g,d,{bottom:0},O);break;case v.None:u.width=0,u.height=0,u.top=0,u.left=0;break;default:u.width=0,u.height=0,u.top=0,u.left=0}return Object(M.a)({},u)}(t,n,o):{top:0,left:0,width:0,height:0};return a.a.createElement("div",{className:"block_magnet-corner-frame",style:Object(M.a)({},r)})},F=[[o.HTML,P]],W=P,J=function(e){var t=e.markerPosition,n=e.size;return a.a.createElement("div",{className:"block_magnet-frame block_magnet-frame--".concat(!t||t[1]?"disabled":"active"),style:{marginTop:-40,marginLeft:-40,width:n[0]+80,height:n[1]+80}})},U=[[o.HTML,J]],q=J,X=function(e){var t=e.activeLevel||O.None,n=t===O.InGroup||t===O.MoveInGroup||t===O.HoverInGroup||t===O.MoveByHandInGroup,o=n?10:0,r=e.size[0]+o,c=e.size[1]+o,i=-o/2,u=-o/2;return a.a.createElement("div",{className:"block_frame block_frame--".concat(n?"selected":"not-selected"),style:{width:r,height:c,marginLeft:i,marginTop:u}},e.children)},Y=[[o.HTML,X]],K=X,Q=($={},Object(d.a)($,r.Anchor,T),Object(d.a)($,r.Box,k),Object(d.a)($,r.Container,V),Object(d.a)($,r.DragFrame,G),Object(d.a)($,r.MagnetCornerFrame,F),Object(d.a)($,r.MagnetBorderFrame,U),Object(d.a)($,r.SelectedFrame,Y),$),Z=function(){return null},ee=(I=o.HTML,{getBlock:function(e){return(Q[e]||[I,Z])[0][1]}}),te=ee.getBlock(r.Box),ne=ee.getBlock(r.Container),oe=function(e){var t=e.size,n=e.xy;return t[0]&&t[1]?a.a.createElement(te,Object.assign({},e,{classModifiers:["silver-bordered"]}),a.a.createElement(ne,{style:{width:t[0],height:t[1]}},e.children),a.a.createElement("div",{style:{fontSize:"12px",position:"absolute",bottom:2,right:2}},a.a.createElement("div",null,"sx=",t[0]),a.a.createElement("div",null,"sy= ",t[1])),a.a.createElement("div",{style:{fontSize:"12px",position:"absolute",bottom:2,left:2}},a.a.createElement("div",null,"x=",n[0]),a.a.createElement("div",null,"y= ",n[1]))):null},re=n(225),ce=n(463),ae=n(470),ie=n(464),ue=n(224),se=n(469),le=n(465),fe=function(e,t){return function(n){return function(o){var r=Object(c.useRef)(t),i=Object(c.useMemo)(function(){return r.current.reduce(function(e,t){return Object(M.a)({},e,t[0])},{})},[r]),u=Object(c.useMemo)(function(){return Object(M.a)({dragStart:new re.a,drag:new re.a,dragStop:new re.a,control:new ce.a(null),group:new ce.a([]),deltaMoves:new re.a,mouseDown:new re.a,mouseMove:new re.a,mouseUp:new re.a,mouseLeave:new re.a,mouseStop:new re.a},i)},[i]);Object(c.useEffect)(function(){console.log("%c start launch plugins ","color: yellow; background-color: darkgreen");var e=r.current.map(function(e){var t=Object(p.a)(e,2),n=(t[0],(0,t[1])(u));return Object(p.a)(n,1)[0]}),t=function(){var t=e.map(function(e){return e()});return function(){t.forEach(function(e){return e&&e()})}}();return function(){console.log("%c stop launch plugins ","color: lime; background-color: darkgreen"),t()}},[u,r]);var s=Object(c.useMemo)(function(){return u.mouseDown.pipe(Object(ie.a)(function(e){return console.warn("tap mouseDowen elementid",e.elementId,e.type)}),Object(ue.a)(function(e){return[e.elementId,Object(M.a)({},e)]}))},[u]),l=Object(c.useMemo)(function(){return s.pipe(Object(ie.a)(function(e){var t=Object(p.a)(e,1)[0];return console.log("start moving!",t)}),Object(se.a)(function(e){return Object(ae.a)(new ce.a(e),u.mouseMove).pipe(Object(le.a)(u.mouseStop.pipe(Object(ie.a)(function(e){var t=e.ev,n=u.control.getValue();u.dragStop.next({elementId:n,ev:t,type:h.StopDrag}),u.control.next(null)}))))}))},[u,s]);Object(c.useEffect)(function(){console.warn("\n\n effect in stream-container");var e=l.subscribe(function(e){var t=Object(p.a)(e,2),n=Object(p.a)(t[0],2),o=n[0],r=n[1],c=t[1],a=[r.ev.clientX,r.ev.clientY],i=a[0],s=a[1];u.deltaMoves.next([o,[c.ev.clientX-i,c.ev.clientY-s]]),u.drag.next(Object(M.a)({},c,{elementId:u.control.getValue()}))}),t=s.subscribe(function(e){var t=Object(p.a)(e,2),n=t[0],o=t[1];u.dragStart.next({elementId:n,type:h.StartDrag,ev:o.ev})}),n=u.mouseStop.subscribe(function(e){var t=u.control.getValue();console.log("stop listening in main Drag container",t)});return function(){console.log("\n\n clear in stream-container"),u.mouseDown.complete(),u.mouseMove.complete(),u.mouseStop.complete(),u.control.complete(),u.deltaMoves.complete(),e.unsubscribe(),t.unsubscribe(),n.unsubscribe()}},[u,l,s]);var f=Object(c.useMemo)(function(){return{onMouseDown:function(e){},onMouseMove:function(e){u.mouseMove.next({elementId:"root",ev:e.nativeEvent,type:h.Move})},onMouseUp:function(e){u.mouseUp.next({elementId:"root",ev:e.nativeEvent,type:h.Cancel}),u.mouseStop.next({elementId:"root",ev:e.nativeEvent,type:h.Cancel})},onMouseLeave:function(e){u.mouseLeave.next({elementId:"root",ev:e.nativeEvent,type:h.Cancel}),u.mouseStop.next({elementId:"root",ev:e.nativeEvent,type:h.Cancel})}}},[u]);return a.a.createElement(n,Object.assign({},o,{handlers:f}),a.a.createElement(e.Provider,{value:u},o.children))}}},be=n(92),ge=n(118),me=n(119),pe=(n(17),n(466),"_init-action_"),de=function(){function e(t,n){Object(ge.a)(this,e),this.state=t,this._reducers=n,this.change=new ce.a({type:pe,payload:null}),this._actionSub=void 0,this._actionSub=this.change.pipe().subscribe(function(e){console.log("action change: ",e)})}return Object(me.a)(e,[{key:"dispatch",value:function(e){return console.log("---\x3edispatch action: ",e),this.change}},{key:"close",value:function(){this.change.complete(),this._actionSub.unsubscribe()}}]),e}(),Oe=a.a.createContext(null),je=Oe,ve=function(){function e(t,n){Object(ge.a)(this,e),this._services=t,this._selectors=n}return Object(me.a)(e,[{key:"send",value:function(e,t){this._services.filter(function(t){return Object(p.a)(t,1)[0]===e}).forEach(function(e){var n=Object(p.a)(e,2);n[0];return(0,n[1])(t)})}},{key:"get",value:function(e,t){var n=this._selectors.find(function(t){var n=Object(p.a)(t,2),o=n[0];n[1];return o===e});return!n&&console.log("%c no selector -> ".concat(e," "),"background-color: magenta; color: yellow"),n&&n[1](t)}}]),e}(),he=function(e){var t=Object(c.useState)(e.getValue()),n=Object(p.a)(t,2),o=n[0],r=n[1];return Object(c.useEffect)(function(){var t=e.subscribe(function(e){return r(e)});return function(){return t.unsubscribe()}},[e]),[o,r]},Le=function(e,t,n){var o=Object(c.useContext)(je);return Object(c.useMemo)(function(){return console.log("%c storage--\x3e","color: green",e,t,n),new ve(t.map(function(e){var t=Object(p.a)(e,2);return[t[0],(0,t[1])(o)]}),n.map(function(e){var t=Object(p.a)(e,2);return[t[0],(0,t[1])(o)]}))},[e,o,t,n])},xe=function(e){return function(t){var n=t.guid,o=t.size$,r=t.position$,i=t.xy$,u=t.activeLevel$,s=Object(be.a)(t,["guid","size$","position$","xy$","activeLevel$"]),l=Object(c.useState)(i.getValue()),f=Object(p.a)(l,2),b=f[0],g=f[1],m=Object(c.useState)(r.getValue()),d=Object(p.a)(m,2),O=d[0],j=d[1],v=Object(c.useState)(o.getValue()),h=Object(p.a)(v,2),L=h[0],x=h[1],B=Object(c.useState)(u.getValue()),R=Object(p.a)(B,2),T=R[0],E=R[1];return Object(c.useEffect)(function(){var e=i.subscribe(function(e){var t=Object(p.a)(e,2),n=t[0],o=t[1];requestAnimationFrame(function(){g([n,o])})}),t=r.subscribe(function(e){var t=Object(p.a)(e,2),n=t[0],o=t[1];requestAnimationFrame(function(){j([n,o])})}),c=o.subscribe(function(e){var t=Object(p.a)(e,2),n=t[0],o=t[1];requestAnimationFrame(function(){x([n,o])})}),a=u.subscribe(function(e){requestAnimationFrame(function(){E(e)})});return function(){console.log("unsubscribe WrappedBlock",n),t.unsubscribe(),e.unsubscribe(),c.unsubscribe(),a.unsubscribe()}},[n,o,r,i,u]),a.a.createElement(e,Object.assign({},s,{guid:n,xy:b,position:O,size:L,activeLevel:T}),t.children)}},Be=function(e){return function(t){var n=t.guid,o=t.size$,r=t.position$,i=t.xy$,u=t.activeLevel$,s=Object(be.a)(t,["guid","size$","position$","xy$","activeLevel$"]),l=o.getValue(),f=u.getValue(),b=Object(c.useMemo)(function(){return r.getValue()},[r]),g=Object(c.useState)(i.getValue()),m=Object(p.a)(g,2),d=m[0],O=m[1];return Object(c.useEffect)(function(){var e=i.subscribe(function(e){var t=Object(p.a)(e,2),n=t[0],o=t[1];requestAnimationFrame(function(){r.next([n,o]),O([n,o])})});return function(){console.log("unsubscribe ConnectedBlock",n),e.unsubscribe()}},[n,r,i]),a.a.createElement(e,Object.assign({},s,{guid:n,xy:d,position:b,size:l,activeLevel:f}),t.children)}},Re=n(467),Te=xe(z),Ee=a.a.createElement("svg",{className:"anchor_icon anchor_icon--move",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},a.a.createElement("path",{fillRule:"evenodd",d:"M7.646.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 1.707V5.5a.5.5 0 0 1-1 0V1.707L6.354 2.854a.5.5 0 1 1-.708-.708l2-2zM8 10a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 0 1 .708-.708L7.5 14.293V10.5A.5.5 0 0 1 8 10zM.146 8.354a.5.5 0 0 1 0-.708l2-2a.5.5 0 1 1 .708.708L1.707 7.5H5.5a.5.5 0 0 1 0 1H1.707l1.147 1.146a.5.5 0 0 1-.708.708l-2-2zM10 8a.5.5 0 0 1 .5-.5h3.793l-1.147-1.146a.5.5 0 0 1 .708-.708l2 2a.5.5 0 0 1 0 .708l-2 2a.5.5 0 0 1-.708-.708L14.293 8.5H10.5A.5.5 0 0 1 10 8z"})),Me=function(e,t){return function(n){var o=n.position$,r=n.size$,i=n.xy$,u=n.activeLevel$,s=Object(be.a)(n,["position$","size$","xy$","activeLevel$"]),l=n.guid,f=n.handlers,b=Object(c.useContext)(at),g=Object(c.useState)(!1),m=Object(p.a)(g,2),d=m[0],j=m[1],v=he(r),h=Object(p.a)(v,1)[0],L=Object(c.useRef)(u.getValue()),x=Object(c.useState)(u.getValue()),B=Object(p.a)(x,2),R=B[0],T=B[1],w=Object(c.useMemo)(function(){return new ce.a([0,0])},[]),k=Object(c.useMemo)(function(){return function(e){return f&&f.onMouseDown&&f.onMouseDown(e)}},[f]);Object(c.useEffect)(function(){var e=w.pipe(Object(Re.a)(function(e,t){return t>0})).subscribe(function(e){var t=Object(p.a)(e,2),n=t[0],r=t[1];o.next([n,r])});return function(){e.unsubscribe()}},[l,i,o,w,u]);var z=Object(c.useMemo)(function(){return{onMouseDown:function(e){k(e)}}},[k]),S=Object(c.useMemo)(function(){return new re.a},[]),V=Object(c.useMemo)(function(){return f?Object(M.a)({},f,{onMouseEnter:function(){S.next(1)},onMouseLeave:function(){S.next(-1)},onMouseDown:function(e){"root"===l&&k(e),"root"!==l&&e.stopPropagation()}}):{}},[S,l,f,k]);Object(c.useEffect)(function(){var e=S.pipe(Object(Re.a)(function(e){return!b.control.getValue()||b.control.getValue()===l}),Object(Re.a)(function(e){return 1!==e||[O.None,O.InGroup].includes(u.getValue())}),Object(Re.a)(function(e){return-1!==e||[O.Hover,O.HoverInGroup].includes(u.getValue())})).subscribe(function(e){var t=u.getValue();1===e?(L.current=t,t=(t=t===O.None?O.Hover:t)===O.InGroup?O.HoverInGroup:t):t=L.current,u.next(t),j(1===e)});return function(){console.log("unsubscribe DragFrame",l),e.unsubscribe()}},[l,S,b,u,L]),Object(c.useEffect)(function(){var e=u.subscribe(function(e){console.log("drag activeLevel "+l,e),T(e)});return function(){return e.unsubscribe()}},[l,u]);var _="root"!==l?["hoverable"]:[],$=R===O.MoveByHand||R===O.Hover?[].concat(_,["draggable","drag-start"]):[].concat(_,["draggable"]),I=n.classModifiers||[],N=[].concat(Object(y.a)(I),["wrapped-by-drag"]),H="root"!==l&&"selecting-frame"!==l,C=t&&t.modifiers||[],D=[].concat(Object(y.a)(I),Object(y.a)(C));return a.a.createElement(Te,Object.assign({},n,{style:null,activeLevel:R,handlers:Object(M.a)({},V),classModifiers:$}),a.a.createElement(A,Object.assign({},s,{classModifiers:D,activeLevel:R,handlers:null,size:[h[0],h[1]],xy:[0,0],position:[0,0]}),H&&R!==O.MoveInGroup&&R!==O.InGroup&&a.a.createElement(E,Object.assign({},n,{handlers:Object(M.a)({},z),activeLevel:R,icon:Ee,classModifiers:d&&H?["active"]:[]})),a.a.createElement(e,Object.assign({},n,{classModifiers:N,position$:w}),n.children)))}},ye=function(e){return function(t,n){return function(o,r,i,u){var s=e(o,u);return function(e){var o=e.guid,i=e.position$,u=e.xy$,l=e.activeLevel$,f=Object(c.useContext)(t),b=Le("draggable: ".concat(o),r,[]),g=Object(c.useRef)(u.getValue()),m=Object(c.useRef)(l.getValue()),d=Object(c.useMemo)(function(){return n(o,f)},[o,f]);return Object(c.useEffect)(function(){var e=f.deltaMoves.pipe(Object(Re.a)(function(e){var t=Object(p.a)(e,1)[0];return o===t})).subscribe(function(e){var t=Object(p.a)(e,2),n=(t[0],t[1]),r=Object(p.a)(n,2),c=r[0],a=r[1],i=Object(p.a)(g.current,2),s=c+i[0],l=a+i[1];b.send("position",[o,[s,l]]),u.next([s,l])});return function(){return e.unsubscribe()}},[f,b,o,u]),Object(c.useEffect)(function(){var e=f.dragStop.pipe(Object(Re.a)(function(e){return e.elementId===o})).subscribe(function(e){l.next(m.current);var t=i.getValue(),n=Object(p.a)(t,2),o=n[0],r=n[1];g.current=[o,r]}),t=f.dragStart.pipe(Object(Re.a)(function(e){return e.elementId===o})).subscribe(function(e){var t=e.type;m.current=l.getValue();var n=t===h.DragInGroup?O.MoveInGroup:m.current;t!==h.DragInGroup&&(n=(n=n===O.Hover?O.MoveByHand:n)===O.HoverInGroup?O.MoveByHandInGroup:n),l.next(n);var o=i.getValue(),r=Object(p.a)(o,2),c=r[0],a=r[1];g.current=[c,a]});return function(){t.unsubscribe(),e.unsubscribe()}},[o,f,i,u,l,g,m]),a.a.createElement(s,Object.assign({},e,{handlers:d}),e.children)}}}},we={magneted:new ce.a([]),magneting:new re.a,magnetingStart:new re.a},ke=function(e){return[e]},ze=[Object(M.a)({},we),function(e){return[(t=e,function(){var e=t.magnetingStart.pipe(Object(ie.a)(function(e){return"selecting-frame"!==e&&"root"!==e}),Object(se.a)(function(e){return t.magneting.pipe(Object(ie.a)(function(e){var n=t.magneted.getValue(),o=Object(p.a)(e.items,1)[0],r=e.direction===x.In?e.items[1]:null,c=e.direction===x.In?n.filter(function(e){return e.magneted[0]!==o||e.magneted[1]!==r}):[],a=e.direction===x.In?[].concat(Object(y.a)(c),[{magneted:[o,r],type:e.type}]):[],i=e.direction===x.Out?n.filter(function(e){return!e.magneted.includes(o)}):[];t.magneted.next([].concat(Object(y.a)(a),Object(y.a)(i)))}),Object(le.a)(t.mouseStop))})).subscribe(function(e){});return function(){e.unsubscribe()}}),ke(e)];var t}];!function(e){e.LeftVertical="left-vertical",e.RightVertical="right-vertical",e.TopHorizontal="top-horizontal",e.BottomHorizontal="bottom-horizontal",e.None="none"}(C||(C={}));var Se,Ve,_e,$e,Ie,Ne,He,Ce=(N={},Object(d.a)(N,C.LeftVertical,v.Left_Vertical),Object(d.a)(N,C.RightVertical,v.Right_Vertical),Object(d.a)(N,C.TopHorizontal,v.Top_Horizontal),Object(d.a)(N,C.BottomHorizontal,v.Bottom_Horizontal),N),De=(H={},Object(d.a)(H,v.Left_Vertical,C.LeftVertical),Object(d.a)(H,v.Right_Vertical,C.RightVertical),Object(d.a)(H,v.Top_Horizontal,C.TopHorizontal),Object(d.a)(H,v.Bottom_Horizontal,C.BottomHorizontal),H),Ge=function(e,t,n,o){var r=Math.abs(e-n),c=Math.abs(t-o),a=Math.abs(e-o),i=Math.abs(t-n);return e<n&&t>o||e>n&&e<o&&t<o&&t>n||e<n&&t>n&&t<o||e>n&&e<o&&t>o?0:Math.min(r,c,a,i)},Ae=function(e,t){return function(n,o,r){var c=function(e,t,n,o,r){var c=Object(p.a)(n,2),a=c[0],i=c[1],u=Object(p.a)(o,2),s=u[0],l=u[1],f=Object(p.a)(t,3),b=f[0],g=f[1],m=f[2],d=-1,O=[],j=Math.abs(g[0]-a),v=Math.abs(g[0]-a-s),h=Math.abs(m[1]-i),L=Math.abs(m[1]-i-l),x=-1;return j>-1&&e>j&&(x=Ge(g[1],m[1],i,i+l))>-1&&x<e&&(d=j,O=[[j,C.LeftVertical,x]]),v>-1&&e>v&&(v<d||d<0)&&(x=Ge(g[1],m[1],i,i+l))>-1&&x<e&&(d=v,O=[[v,C.RightVertical,x]]),h>-1&&e>h&&(h<d||d<0)&&(x=Ge(b[0],g[0],a,a+s))>-1&&x<e&&(d=h,O=[[h,C.TopHorizontal,x]]),L>-1&&e>L&&(L<d||d<0)&&(x=Ge(b[0],g[0],a,a+s))>-1&&x<e&&(d=L,O=[[L,C.BottomHorizontal,x]]),Object(y.a)(O)}(e,t,o.position,o.size);return Object(y.a)(c)}},Pe=[[v.TopLeft,1,v.TopLeft_LeftBottom],[v.TopLeft,2,v.TopLeft_LeftTop],[v.TopLeft,3,v.TopLeft_TopLeft],[v.TopLeft,4,v.TopLeft_TopRight],[v.TopRight,5,v.TopRight_TopLeft],[v.TopRight,6,v.TopRight_TopRight],[v.TopRight,7,v.TopRight_RightTop],[v.TopRight,8,v.TopRight_RightBottom],[v.BottomRight,9,v.BottomRight_RightTop],[v.BottomRight,10,v.BottomRight_RightBottom],[v.BottomRight,11,v.BottomRight_BottomRight],[v.BottomRight,12,v.BottomRight_BottomLeft],[v.BottomLeft,13,v.BottomLeft_BottomRight],[v.BottomLeft,14,v.BottomLeft_BottomLeft],[v.BottomLeft,15,v.BottomLeft_LeftBottom],[v.BottomLeft,16,v.BottomLeft_LeftTop]],Fe=function(e,t){var n=Pe.find(function(n){var o=Object(p.a)(n,3),r=o[0],c=o[1];o[2];return e===r&&t===c});return n?n[2]:v.None},We=(Ie={},Object(d.a)(Ie,v.TopLeft,(Se={},Object(d.a)(Se,v.TopLeft,v.None),Object(d.a)(Se,v.TopRight,v.LeftTop),Object(d.a)(Se,v.BottomRight,v.TopLeft),Object(d.a)(Se,v.BottomLeft,v.TopLeft),Se)),Object(d.a)(Ie,v.TopRight,(Ve={},Object(d.a)(Ve,v.TopLeft,v.RightTop),Object(d.a)(Ve,v.TopRight,v.None),Object(d.a)(Ve,v.BottomRight,v.TopRight),Object(d.a)(Ve,v.BottomLeft,v.RightTop),Ve)),Object(d.a)(Ie,v.BottomLeft,(_e={},Object(d.a)(_e,v.TopLeft,v.BottomLeft),Object(d.a)(_e,v.TopRight,v.LeftBottom),Object(d.a)(_e,v.BottomRight,v.LeftBottom),Object(d.a)(_e,v.BottomLeft,v.None),_e)),Object(d.a)(Ie,v.BottomRight,($e={},Object(d.a)($e,v.TopLeft,v.RightBottom),Object(d.a)($e,v.TopRight,v.BottomRight),Object(d.a)($e,v.BottomRight,v.None),Object(d.a)($e,v.BottomLeft,v.RightBottom),$e)),Ie),Je=function(e,t,n,o){return o.filter(function(t){return t.guid!==e}).reduce(function(e,o){var r=function(e,t,n){var o=Object(p.a)(n.position,2),r=o[0],c=o[1],a=Object(p.a)(n.size,2),i=a[0],u=a[1],s=[[r,c],[r+i,c],[r+i,c+u],[r,c+u]].reduce(function(o,r,c){var a=Object(p.a)(r,2),i=a[0],u=a[1],s=[v.TopLeft,v.TopRight,v.BottomRight,v.BottomLeft][c],l=e.reduce(function(e,t,n){var o=t||[0,0],r=Object(p.a)(o,2),c=r[0],a=r[1],s=i-c,l=u-a,f=s*s+l*l,b=[v.TopLeft,v.TopRight,v.BottomRight,v.BottomLeft][n];return t&&(e[0]>f||e[0]<0)?[f,[c,a],b]:e},[-1,[0,0],v.None]),f=Object(p.a)(l,3),b=f[0],g=f[1],m=f[2],d=[s,Object(M.a)({},n,{position:[i,u]})],O=[m,Object(M.a)({},t,{position:[g[0],g[1]]})];return o[0]>b||o[0]<0?[b,Object(M.a)({},O),Object(M.a)({},d),s]:o},[-1,null,null,v.None]),l=Object(p.a)(s,4),f=l[0],b=l[1],g=l[2],m=l[3];return[Math.round(Math.sqrt(f)),b,g,m]}(t,n,o),c=Object(p.a)(r,4),a=c[0],i=c[1],u=c[2],s=c[3],l=i?i[0]:v.None,f=We[s]&&We[s][l];return e[0]>a||e[0]<0?[a,i,u,f||v.None]:e},[-1,null,null,v.None])},Ue=function(e,t){var n=t.CAPTURE_DELTA,o=t.Indents;return function(t){return function(r,i,u){var s=e(r);return function(e){var r=e.guid,l=e.xy$,f=e.size$,b=Le("magnetable: ".concat(r),i,u),g=Object(c.useRef)(null),m=Object(c.useMemo)(function(){return new ce.a([null,null])},[]),d=Object(c.useContext)(t),O=Object(c.useMemo)(function(){return new ce.a(null)},[]),j=Object(c.useMemo)(function(){return new ce.a(null)},[]);Object(c.useEffect)(function(){console.log("%c storage--\x3e init_magnetable 1: ","color: green; background-color: yellow;",r);var e=d.dragStop.pipe(Object(Re.a)(function(e){return e.elementId!==r})).subscribe(function(e){var t=e.elementId,n=j.getValue();n&&n.magneted===t&&j.next(null)}),t=d.resizeStop.pipe(Object(Re.a)(function(e){return e.elementId!==r})).subscribe(function(e){var t=e.elementId,n=j.getValue();n&&n.magneted===t&&j.next(null)});return function(){e.unsubscribe(),t.unsubscribe()}},[r,d,j]),Object(c.useEffect)(function(){console.log("%c storage--\x3e init_magnetable 2: ","color: green; background-color: yellow;",r);var e=d.magneting.pipe(Object(Re.a)(function(e){return e.direction===x.In&&r===e.items[0]})).subscribe(function(e){var t=e.type,n=e.items,o=l.getValue(),c=f.getValue(),a={frame:[[o[0],o[1]],[c[0],c[1]]],magnetType:t,magneted:n[1],fix:r};j.next(Object(M.a)({},a))});return function(){e.unsubscribe()}},[r,d,l,f,j]);var h=Object(c.useCallback)(function(e,t,c){var a=l.getValue(),i=Object(p.a)(a,2),u=i[0],s=i[1],m=f.getValue(),O=Object(p.a)(m,2),j=O[0],h=O[1],L={guid:r,position:[u,s],size:[j,h]},B=b.get("controls").filter(function(e){return e.guid!==r}).map(function(e){return{guid:e.guid,position:e.position,size:e.size}}),R=[],T=Je(r,c,L,B),E=Object(p.a)(T,4),M=E[0],w=E[1],k=E[2],z=E[3];w&&k&&R.push.apply(R,Object(y.a)(function(e,t){var n=Object(p.a)(t,4),o=n[0],r=n[1],c=n[2],a=n[3];return function(t,n,i,u){var s=i[0],l=Object(p.a)(n[1].size,2),f=l[0],b=l[1],g=n[0],m=i[1],d=m.guid,O=Object(p.a)(m.position,2),j=O[0],h=O[1],L=Object(p.a)(m.size,2),x=L[0],B=L[1],R=Object(p.a)(n[1].position,2),T=R[0],E=R[1];if(t>e)return[];if(s===g)return[];var M=[],w=[v.TopLeft,v.BottomLeft].indexOf(s)>-1?1:0,k=[v.TopLeft,v.TopRight].indexOf(s)>-1?1:0,z=j-w*a+(1-w)*r,S=h-k*o+(1-k)*c,V=0,_=1;(z-T)*(z-T)+(h-E)*(h-E)<(j-T)*(j-T)+(S-E)*(S-E)?V=h:(V=S,_=0);var $=0,I=0,N=s,H=0;switch(g){case v.TopRight:H=k?1:15,H=k||_?H:12*(1-w)+14*w;var C=k?[z-w*f,h]:[_*z+(1-_)*j-f,V],D=Object(p.a)(C,2);$=D[0],I=D[1],M=(N=Fe(s,H))!==v.None?[[d,[$,I],[x,B],N]]:[];break;case v.TopLeft:H=k?8:10;var G=[8,10].indexOf(H=k||_?H:11*(1-w)+13*w)>-1?[z,h]:[j,S],A=Object(p.a)(G,2);$=A[0],I=A[1],M=(N=Fe(s,H))!==v.None?[[d,[$,I],[x,B],N]]:[];break;case v.BottomRight:H=_?16*(1-k)+2*k:5*(1-w)+3*w;var P=_?[z-f,h-b]:[j-f,S-b],F=Object(p.a)(P,2);$=F[0],I=F[1],M=(N=Fe(s,H))!==v.None?[[d,[$,I],[x,B],N]]:[];break;case v.BottomLeft:H=_?9*(1-k)+7*k:6*(1-w)+4*w;var W=_?[z,h-b]:[j,S-b],J=Object(p.a)(W,2);$=J[0],I=J[1],M=(N=Fe(s,H))!==v.None?[[d,[$,I],[x,B],N]]:[]}return Object(y.a)(M)}}(n,o)(M,w,k,z))),!R.length&&g.current&&(d.magneting.next({direction:x.Out,items:[r]}),t()),e(R)},[r,d,f,l,b]),L=Object(c.useCallback)(function(e,t,c){var a=l.getValue(),i=Object(p.a)(a,2),u=i[0],s=i[1],g=f.getValue(),m=Object(p.a)(g,2),O=m[0],j=m[1],h={guid:r,position:[u,s],size:[O,j]},L=b.get("controls").filter(function(e){return e.guid!==r}).map(function(e){return{guid:e.guid,position:e.position,size:e.size}});return function(e,t){return function(n,o,r){return function(n,o){var c=e.reduce(function(e,n,o){var c=Object(p.a)(e,2),a=Object(p.a)(c[0],2),i=a[0],u=a[1],s=c[1],l=Object(p.a)(n,4),f=l[0],b=l[1],g=l[2],m=l[3];if(b!==C.None&&g){var d=-1,O=s[0],j=s[1];if(b!==C.LeftVertical&&b!==C.RightVertical||(O>f||O<0)&&(O=f,d=0),b!==C.TopHorizontal&&b!==C.BottomHorizontal||(j>f||j<0)&&(j=f,d=1),d>-1){var v=t(f,r,[f,b,g,m]);return console.log("%c new nearest: >","color: yellow; background-color: #345; border: 1px solid orange;",f,b,g),0===d?[[v,u],[O,j]]:[[i,v],[O,j]]}}return[[i,u],s]},[[[],[]],[-1,-1]])[0],a=[c[0],c[1]];a[0].length||a[1].length?n(a):o()}}}(function(e,t){var n=Object(p.a)(t,4);return n[0],n[1],n[2],n[3],function(t,n){var o=Ae(e,[t[0],t[1],t[2],t[3]]);return n.reduce(function(e,t,n){var r=o(e,t),c=r.map(function(e){var n=Object(p.a)(e,3),o=n[0],r=n[1],c=n[2];return[o,r,t,c]});return r.length?[].concat(Object(y.a)(e),Object(y.a)(c)):e},[])}}(n,o)(c,L),function(e,t){var n=Object(p.a)(t,4);return n[0],n[1],n[2],n[3],function(t,n,o){var r=Object(p.a)(n.position,2),c=r[0],a=r[1],i=Object(p.a)(n.size,2),u=i[0],s=i[1],l=Object(p.a)(o,4),f=l[0],b=l[1],g=l[2],m=l[3];if(console.log("minDistanceToAnotherEdge",m,g.guid),f<e&&m<e){var d=u,O=s,j=Object(p.a)(g.position,2),h=j[0],L=j[1],x=Object(p.a)(g.size,2),B=x[0],R=x[1],T=h-c,E=L-a;switch(b){case C.LeftVertical:var M=T>50?[T,s]:[u,s],y=Object(p.a)(M,2);d=y[0],O=y[1];break;case C.RightVertical:var w=T+B>50?[T+B,s]:[u,s],k=Object(p.a)(w,2);d=k[0],O=k[1];break;case C.TopHorizontal:var z=E>50?[u,E]:[u,s],S=Object(p.a)(z,2);d=S[0],O=S[1];break;case C.BottomHorizontal:var V=E+R>50?[u,E+R]:[u,s],_=Object(p.a)(V,2);d=_[0],O=_[1];break;default:d=u,O=s}return[[g.guid,[d,O],g.size,Ce[b]||v.None]]}return[]}}(n,o))(r,d,h)(e,t)},[r,d,b,l,f]);return Object(c.useEffect)(function(){console.log("%c \nstart subs nearest >\n","background-color: #111; color: white; border: 1px solid orange;");var e=d.magneting.pipe(Object(Re.a)(function(e){var t=e.direction===x.Out,n=d.magneted.getValue(),o=t&&!!n.filter(function(e){return e.magneted.includes(r)}).length;return t&&console.log("%c outing-item ---\x3e","color: yellow; background-color: black; border: orange;",o,r,n,e),o})).subscribe(function(e){console.log("---\n\n outing-item MAGNETING_SUB->",e,r,j.getValue(),O.getValue()),g.current=null,j.next(null),O.next(null)}),t=d.dragStop.pipe(Object(Re.a)(function(e){return e.elementId===r})).subscribe(function(e){if(console.log("stop listening ->",r,g.current,d.group.getValue()),g.current){var t=Object(p.a)(g.current,1),n=Object(p.a)(t[0],2),o=n[0],c=n[1];g.current=null,j.next(null),b.send("position",[r,[o,c]]),O.next([[o,c],1])}}),n=d.dragStart.pipe(Object(Re.a)(function(e){return e.elementId===r})).subscribe(function(e){d.magnetingStart.next(r),d.magneting.next({direction:x.Out,items:[r]})}),o=d.drag.pipe(Object(Re.a)(function(e){var t=e.elementId;return t===r&&d.group.getValue().findIndex(function(e){return e===t})<0})).subscribe(function(e){var t=l.getValue(),n=Object(p.a)(t,2),o=n[0],c=n[1],a=f.getValue(),i=Object(p.a)(a,2),u=i[0],s=i[1];h(function(e){e.forEach(function(e){var t=Object(p.a)(e,4),n=t[0],o=t[1],c=(t[2],t[3]);g.current&&g.current[1]===c||(d.magneted.getValue().length&&d.magneting.next({direction:x.Out,items:[r]}),d.magneting.next({direction:x.In,items:[n,r],type:c}),g.current=[[o[0],o[1]],c],O.next([[o[0],o[1]],0]))})},function(){g.current=null,j.next(null),O.next(null)},[[o,c],[o+u,c],[o+u,c+s],[o,c+s]])}),c=d.resizeStart.pipe(Object(Re.a)(function(e){return e.elementId===r})).subscribe(function(e){d.magnetingStart.next(r),d.magneting.next({direction:x.Out,items:[r]})}),a=d.resizeStop.pipe(Object(Re.a)(function(e){return e.elementId===r})).subscribe(function(e){var t=m.getValue(),n=Object(p.a)(t,2),o=n[0],c=n[1];if(console.log("resizing stop! ->",r,o,c),o||c){var a=f.getValue(),i=[o,c].map(function(e){return e?[De[e[3]]||C.None,e[1]]:[C.None,[-1,-1]]}),u=i.reduce(function(e,t){var n=Object(p.a)(t,2),o=n[0],r=Object(p.a)(n[1],2),c=r[0],a=r[1];return[o===C.LeftVertical||o===C.RightVertical?c:e[0],o===C.TopHorizontal||o===C.BottomHorizontal?a:e[1]]},[-1,-1]),s=Object(p.a)(u,2),l=s[0],g=s[1],d=l>-1?l:a[0],v=g>-1?g:a[1];f.next([d,v]),b.send("size",[r,[d,v]]),m.next([null,null]),j.next(null),O.next(null)}}),i=d.resize.pipe(Object(Re.a)(function(e){return Object(p.a)(e,1)[0]===r})).subscribe(function(e){Object(p.a)(e,1)[0];var t=l.getValue(),n=Object(p.a)(t,2),o=n[0],c=n[1],a=f.getValue(),i=Object(p.a)(a,2),u=i[0],s=i[1];L(function(e){var t=m.getValue(),n=Object(p.a)(t,2),o=n[0],c=n[1],a=Object(p.a)(e,2),i=a[0],u=a[1],s=o,l=c,f=0,b=o&&!!i.filter(function(e){var t=Object(p.a)(e,4),n=t[0],r=(t[1],t[2],t[3]);return n===o[0]&&r!==o[3]||n!==o[0]}).length;b&&console.log("isNewVert",b,[o,c],[i&&i[0],u&&u[0]]),(o&&!i.length||!o&&i.length||b)&&(f=1,s=i[0]);var g=c&&!!u.filter(function(e){var t=Object(p.a)(e,4),n=t[0],o=(t[1],t[2],t[3]);return n===c[0]&&o!==c[3]||n!==c[0]}).length;(c&&!u.length||!c&&u.length||g)&&(f=3-f,l=u[0]),f&&(m.next([s||null,l||null]),(s||l)&&((o||c)&&d.magneting.next({direction:x.Out,items:[r]}),[s,l].filter(function(e){return!!e}).reduce(function(e,t){var n=Object(p.a)(t,4),o=n[0],r=(n[1],n[2],n[3]);return e.findIndex(function(e){var t=Object(p.a)(e,2),n=t[0],c=t[1];return n===o&&c===r})>-1?Object(y.a)(e):[].concat(Object(y.a)(e),[[o,r]])},[]).forEach(function(e){var t=Object(p.a)(e,2),n=t[0],o=t[1];return d.magneting.next({direction:x.In,items:[n,r],type:o})}),O.next([[-1,-1],0])))},function(){var e=m.getValue(),t=Object(p.a)(e,2),n=t[0],o=t[1];if(n||o){var r=n?[n[0]]:[];o&&!r.filter(function(e){return e&&e[0]===o[0]}).length&&r.push(o[0]),r.forEach(function(e){return d.magneting.next({direction:x.Out,items:[e]})}),g.current=null,j.next(null),m.next([null,null]),O.next(null)}},[[o,c],[o+u,c],[o+u,c+s],[o,c+s]])});return function(){e.unsubscribe(),o.unsubscribe(),n.unsubscribe(),t.unsubscribe(),i.unsubscribe(),c.unsubscribe(),a.unsubscribe()}},[r,d,b,l,f,O,j,g,m,L,h]),a.a.createElement(s,Object.assign({},e,{markerPosition$:O,nearestFrame$:j}),e.children)}}}}(function(e){return function(t){var n=t.guid,o=t.position$,r=t.xy$,i=t.markerPosition$,u=t.size$,s=t.nearestFrame$,l=Object(c.useState)(i.getValue()),f=Object(p.a)(l,2),b=f[0],g=f[1],m=he(u),d=Object(p.a)(m,1)[0],O=he(s),j=Object(p.a)(O,1)[0];Object(c.useEffect)(function(){var e=i.subscribe(function(e){e&&1===e[1]&&r.next([e[0][0],e[0][1]]),g(e)});return function(){return e.unsubscribe()}},[n,i,r,o]);var h=[v.Left_Vertical,v.Right_Vertical,v.Top_Horizontal,v.Bottom_Horizontal],L=j&&h.indexOf(j.magnetType)<0,x=j&&h.indexOf(j.magnetType)>-1;return a.a.createElement(a.a.Fragment,null,a.a.createElement(q,{size:[d[0],d[1]],markerPosition:b}),x&&a.a.createElement(W,{type:j?j.magnetType:null,offset:0,indent:[30,50,30,50]}),x&&a.a.createElement(W,{type:j?j.magnetType:null,offset:1,indent:[30,50,30,50]}),L&&a.a.createElement(W,{type:j?j.magnetType:null,indent:[30,50,30,50]}),a.a.createElement(e,t,t.children))}},{CAPTURE_DELTA:80,Indents:[30,50,30,50]}),qe={resize:new re.a,resizeStart:new re.a,resizeStop:new re.a},Xe=function(e){return[e]},Ye=[Object(M.a)({},qe),function(e){return[(t=e,function(){var e=t.resizeStart.pipe(Object(ie.a)(function(e){var t=e.elementId;return console.log("start resize!",t)}),Object(ie.a)(function(e){var n=e.elementId;return t.control.next(n)}),Object(se.a)(function(e){return Object(ae.a)(new ce.a(e),t.mouseMove).pipe(Object(le.a)(t.mouseStop.pipe(Object(ie.a)(function(e){var n=e.ev,o=t.control.getValue();t.resizeStop.next({elementId:o,ev:n,type:h.StopResize}),t.control.next(null)}))))})).subscribe(function(e){var n=Object(p.a)(e,2),o=n[0],r=n[1],c=[o.ev.clientX,o.ev.clientY],a=c[0],i=c[1];t.resize.next([o.elementId,[r.ev.clientX-a,r.ev.clientY-i]])});return function(){e.unsubscribe()}}),Xe(e)];var t}],Ke=a.a.createElement("svg",{className:"anchor_icon anchor_icon--resize",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",fill:"currentColor"},a.a.createElement("line",{fill:"none",stroke:"currentColor",strokeWidth:"2",strokeMiterlimit:"10",x1:"6",y1:"26",x2:"26",y2:"6"}),a.a.createElement("polyline",{fill:"none",stroke:"currentColor",strokeWidth:"2",strokeMiterlimit:"10",points:"13,27 5,27 5,19 "}),a.a.createElement("polyline",{fill:"none",stroke:"currentColor",strokeWidth:"2",strokeMiterlimit:"10",points:"19,5 27,5 27,13 "}),a.a.createElement("line",{fill:"none",stroke:"currentColor",strokeWidth:"2",strokeMiterlimit:"10",x1:"6",y1:"6",x2:"26",y2:"26"}),a.a.createElement("polyline",{fill:"none",stroke:"currentColor",strokeWidth:"2",strokeMiterlimit:"10",points:"5,13 5,5 13,5 "}),a.a.createElement("polyline",{fill:"none",stroke:"currentColor",strokeWidth:"2",strokeMiterlimit:"10",points:"27,19 27,27 19,27 "})),Qe=function(e){return function(t){return function(n,o,r){var i=e(n,t);return function(e){var n=e.guid,u=e.activeLevel$,s=e.size$,l=Le("resizable: ".concat(n),o,r),f=Object(c.useContext)(t),b=Object(c.useRef)(s.getValue());return Object(c.useEffect)(function(){var e=f.resizeStart.pipe(Object(Re.a)(function(e){return e.elementId===n})).subscribe(function(e){var t=s.getValue(),n=Object(p.a)(t,2),o=n[0],r=n[1];b.current=[o,r]}),t=f.resize.pipe(Object(Re.a)(function(e){var t=Object(p.a)(e,1)[0];return n===t})).subscribe(function(e){var t=Object(p.a)(e,2),o=(t[0],t[1]),r=Object(p.a)(o,2),c=r[0],a=r[1],i=b.current[0]+c,u=b.current[1]+a;if(i>60||u>60){var f=s.getValue(),g=Object(p.a)(f,2),m=g[0],d=g[1],O=i>60?i:m,j=u>60?u:d;l.send("size",[n,[O,j]]),s.next([O,j])}});return function(){console.log("subscription unsub!",n),t.unsubscribe(),e.unsubscribe()}},[n,f,l,u,b,s]),a.a.createElement(i,e,e.children)}}}}(function(e,t){return function(n){var o=n.guid,r=n.activeLevel$,i=n.handlers,u=Object(c.useContext)(t),s=he(r),l=Object(p.a)(s,1)[0],f=Object(c.useMemo)(function(){return i?Object(M.a)({},i,{onMouseDown:function(){}}):{onMouseDown:function(){}}},[i]),b=Object(c.useMemo)(function(){return{onMouseDown:function(e){e.stopPropagation(),u.resizeStart.next({elementId:o,ev:e.nativeEvent,type:h.Resize})}}},[o,u]),g=Object(c.useMemo)(function(){return"root"===o?i:f},[o,i,f]),m=l?["resizer","active"]:["resizer"];return a.a.createElement(e,Object.assign({},n,{handlers:g}),n.children,(l===O.Hover||l===O.HoverInGroup)&&a.a.createElement(E,Object.assign({},n,{handlers:Object(M.a)({},b),classModifiers:[].concat(m),icon:Ke})))}}),Ze=n(468),et={lasso:new re.a,trapping:new re.a},tt=function(e){return[e]},nt=[Object(M.a)({},et),function(e){return[(t=e,function(){var e=t.dragStart.pipe(Object(ie.a)(function(e){return"selecting-frame"===e.elementId&&t.group.next([])}),Object(se.a)(function(e){return t.trapping.pipe(Object(Ze.a)(function(e,t){var n=Object(p.a)(t,1)[0],o=e.filter(function(e){return n&&e.guid===n.guid}).length?[]:[n];return n&&n.trappedType===L.In?[].concat(Object(y.a)(e),o):e.filter(function(e){return n&&e.guid!==n.guid})},[]),Object(ie.a)(function(e){return t.group.next(e.map(function(e){return e.guid}))}),Object(le.a)(t.mouseStop))})).subscribe(function(e){});return function(){e.unsubscribe()}}),tt(e)];var t}],ot=function(e){return function(t){return function(n){var o=e(n);return function(e){var n=e.activeLevel$,r=e.guid,i=e.xy$,u=e.position$,s=e.size$,l=Object(c.useRef)(n.getValue()),f=Object(c.useRef)([0,0]),b=Object(c.useState)(!1),g=Object(p.a)(b,2),m=g[0],d=g[1],j=Object(c.useRef)(m),v=Object(c.useRef)(!1),x=Object(c.useContext)(t);Object(c.useEffect)(function(){var e=x.mouseDown.pipe(Object(Re.a)(function(e){var t=e.elementId;return j.current&&("selecting-frame"===t||!x.group.getValue().includes(t))&&x.group.getValue().includes(r)})).subscribe(function(e){var t=e.ev;v.current=!1,x.dragStop.next({elementId:r,ev:t,type:h.StopDrag}),x.group.next(x.group.getValue().filter(function(e){return e!==r})),j.current=!1,n.next(O.None),d(!1)});return function(){e.unsubscribe()}},[r,x,n,j,v]),Object(c.useEffect)(function(){var e=x.mouseStop.pipe(Object(Re.a)(function(e){return v.current&&j.current&&x.group.getValue().includes(r)})).subscribe(function(e){var t=e.ev;v.current=!1,x.dragStop.next({elementId:r,ev:t,type:h.StopDrag})});return function(){e.unsubscribe()}},[r,x,j,v]),Object(c.useEffect)(function(){var e=x.mouseDown.pipe(Object(Re.a)(function(e){var t=e.elementId;return j.current&&"selecting-frame"!==t&&x.group.getValue().includes(t)}),Object(ie.a)(function(e){return f.current=i.getValue()}),Object(ie.a)(function(e){var t=e.ev,n=e.elementId;v.current||(v.current=!0),r!==n&&x.dragStart.next({elementId:r,ev:t,type:h.DragInGroup})}),Object(se.a)(function(e){var t=e.elementId;return x.deltaMoves.pipe(Object(Re.a)(function(e){var n=Object(p.a)(e,2),o=n[0];return n[1],o===t&&o===r}),Object(le.a)(x.dragStop.pipe(Object(Re.a)(function(e){return e.elementId===r}))))})).subscribe(function(e){var t=Object(p.a)(e,2),n=(t[0],t[1]),o=Object(p.a)(f.current,2),c=o[0],a=o[1];i.next([c+n[0],a+n[1]]),x.group.getValue().forEach(function(e){return e!==r&&x.deltaMoves.next([e,n])})});return function(){e.unsubscribe()}},[r,x,f,i,u,n,j,v]),Object(c.useEffect)(function(){var e=x.lasso.subscribe(function(e){var t=e.end,o=e.start,c=(e.trapped,i.getValue()),a=s.getValue(),u=[c[0]+a[0],c[1]+a[1]],f=o[0]<c[0]&&t[0]>u[0];if((f=f&&o[1]<c[1]&&t[1]>u[1])!==j.current&&(t[0]||t[1]||o[0]||o[1])){f&&x.trapping.next([{guid:r,trappedType:L.In}]),!f&&x.trapping.next([{guid:r,trappedType:L.Out}]),j.current=f;var b=n.getValue();f?(l.current=n.getValue(),b=(b=b===O.None?O.InGroup:b)===O.Hover?O.HoverInGroup:b):b=l.current,n.next(b),d(f)}});return function(){e.unsubscribe()}},[r,x,i,s,n,l,j]);var B=e.classModifiers||[],R=m?[].concat(Object(y.a)(B),["in-lasso-trapped"]):Object(y.a)(B);return a.a.createElement(o,Object.assign({},e,{classModifiers:R}),e.children)}}}},rt=xe(K),ct=ot(function(e){return function(t){var n=Object(c.useMemo)(function(){return new ce.a([0,0])},[]);return a.a.createElement(rt,Object.assign({},t,{position$:n}),a.a.createElement(e,t,t.children))}}),at=a.a.createContext(null),it=fe(at,[Ye,ze,nt]),ut=ye(Me)(at,function(e,t){return{onMouseDown:function(n){if(n.stopPropagation(),n.button===B.Left){var o=n.ctrlKey?"selecting-frame":e;t.control.next(o),console.log("start on mouseDown",o),t.mouseDown.next({ev:n.nativeEvent,type:n.ctrlKey?h.StartSelecting:h.StartDrag,elementId:o})}},onMouseUp:function(e){}}}),st=Ue(at),lt=Qe(at),ft=ct(at),bt=(Ne=at,function(e){return function(t){var n=t.size$,o=t.position$,r=t.offsetPosition$,i=Object(c.useContext)(Ne),u=Object(c.useRef)([0,0]),s=Object(c.useRef)([]),l=Object(c.useMemo)(function(){return new ce.a(n.getValue())},[n]),f=Object(c.useMemo)(function(){return new ce.a([0,0])},[]),b=Object(c.useMemo)(function(){return new ce.a([0,0])},[]);return Object(c.useEffect)(function(){console.log("%c init sub in Lasso ","background-color: yellow; color: red; border: 1px solid black;");var e=i.dragStart.pipe(Object(Re.a)(function(e){return"selecting-frame"===e.elementId}),Object(ie.a)(function(e){var t=e.ev,n=r.getValue(),c=Object(p.a)(n,2),a=c[0],i=c[1];console.log("offsetPosition$",[a,i]),u.current=[t.clientX-a,t.clientY-i],o.next([t.clientX-a,t.clientY-i])}),Object(se.a)(function(e){return i.deltaMoves.pipe(Object(le.a)(i.dragStop.pipe(Object(ie.a)(function(e){u.current=[0,0],o.next([0,0]),l.next([0,0]),i.lasso.next({start:[0,0],end:[0,0],trapped:[]})}))))})).subscribe(function(e){var t=Object(p.a)(e,2),n=(t[0],t[1]),r=Object(p.a)(n,2),c=r[0],a=r[1],s=Object(p.a)(u.current,2),f=s[0],b=s[1],g=f,m=b,d=c,O=a;c<0&&(d=-c,g=f+c),a<0&&(O=-a,m=b+a),(c<0||a<0)&&o.next([g,m]),l.next([d,O]),i.lasso.next({start:[g,m],end:[g+d,m+O],trapped:[]})});return function(){console.log("%c unsub in selectable lasso: handlers ","color: yellow; background-color: brown;"),e.unsubscribe()}},[i,b,l,o,r,u,s]),a.a.createElement(e,Object.assign({},t,{size$:l,xy$:b,position$:f,classModifiers:["selectable"],classBlocks:["block"],classElements:["selecting-frame"]}),t.children)}}),gt=(ee.getBlock(r.Container),it(_)),mt=function(e){return c.createElement(gt,Object.assign({},e,{guid:"root",classModifiers:["silver-bordered","relative-hidden"]}),e.children)},pt=(n(459),ee.getBlock(r.Container)),dt=function(e){var t=e.xy,n=e.size;return a.a.createElement(pt,Object.assign({},e,{classModifiers:e.classModifiers?["ctrl-bordered"].concat(Object(y.a)(e.classModifiers)):["ctrl-bordered"]}),a.a.createElement("div",{className:"content-wrapper",style:e.style},a.a.createElement("div",{style:{fontSize:"14px"}},e.name)),e.children,a.a.createElement("div",{style:{fontSize:"14px",position:"absolute",bottom:2,right:2}},a.a.createElement("div",null,"sx=",n[0]),a.a.createElement("div",null,"sy= ",n[1])),a.a.createElement("div",{style:{fontSize:"14px",position:"absolute",bottom:2,left:2}},a.a.createElement("div",null,"x=",t[0]),a.a.createElement("div",null,"y= ",t[1])))},Ot=[["position",function(e){return function(t){var n=Object(p.a)(t,2),o=n[0],r=n[1];e.state.controls$.next(e.state.controls$.getValue().map(function(e){return e.guid===o?Object(M.a)({},e,{position:[r[0],r[1]]}):Object(M.a)({},e)}))}}],["size",function(e){return function(t){var n=Object(p.a)(t,2),o=n[0],r=n[1];e.state.controls$.next(e.state.controls$.getValue().map(function(e){return e.guid===o?Object(M.a)({},e,{size:[r[0],r[1]]}):Object(M.a)({},e)}))}}]],jt=[["controls",function(e){return function(){return e.state.controls$.getValue()}}]],vt=ee.getBlock(r.Box),ht=ut(st(ft(lt(Be(function(e){return a.a.createElement(vt,e,a.a.createElement(dt,Object.assign({},e,{position:[0,0]})))}),Ot,[])),Ot,jt),Ot,[]),Lt=function(e){var t=e.component,n=e.controls$,o=Object(c.useState)([]),r=Object(p.a)(o,2),i=r[0],u=r[1];return Object(c.useEffect)(function(){var e=n.pipe().subscribe(function(e){u(Object(y.a)(e))});return function(){return e.unsubscribe()}},[n]),a.a.createElement(c.Fragment,null,i.map(function(e){return a.a.createElement(t,Object.assign({key:"".concat(e.guid,"-").concat(e.name)},e))}))},xt=a.a.memo(ht),Bt=function(e){var t=e.offsetPosition$,n=Object(c.useRef)([]),o=Le("stored-workspace",n.current,jt),r=Object(c.useMemo)(function(){return new ce.a([])},[]);return Object(c.useEffect)(function(){var e=t.getValue(),n=Object(p.a)(e,2),c=n[0],a=n[1],i=o.get("controls");r.next(i.map(function(e){return{guid:e.guid,name:"".concat(e.uiType,"-").concat(e.guid),activeLevel$:new ce.a(O.None),xy$:new ce.a([e.position[0],e.position[1]]),position$:new ce.a([e.position[0],e.position[1]]),size$:new ce.a([e.size[0],e.size[1]]),style:e.style,offsetPosition$:new ce.a([c,a])}}))},[o,r,t]),a.a.createElement(Lt,{component:xt,controls$:r,offsetPosition$:new ce.a([0,0])})},Rt=[],Tt=[["observerable-data",function(e){return function(){return e.state.root$}}]],Et=ut(bt(xe(ee.getBlock(r.Box))),Rt,[],{modifiers:["no-frame"]}),Mt=function(e){var t=e.offsetPosition$,n=Le("root-for-lasso",Rt,Tt),o=Object(c.useMemo)(function(){return new ce.a(O.None)},[]),r=Object(c.useMemo)(function(){return new ce.a([0,0])},[]),i=Object(c.useMemo)(function(){return new ce.a([0,0])},[]),u=Object(c.useMemo)(function(){return new ce.a([0,0])},[]);return Object(c.useEffect)(function(){console.log("%c init effect inside result-lasso ","color: red; background-color: silver;");var e=t.getValue(),o=Object(p.a)(e,2),r=o[0],c=o[1],a=n.get("observerable-data").subscribe(function(e){var n=e.position;return t.next([r+n[0],c+n[1]])});return function(){return a.unsubscribe()}},[n,t]),a.a.createElement(Et,{guid:"selecting-frame",activeLevel$:o,offsetPosition$:t,position$:r,xy$:i,size$:u})},yt=[["position",function(e){return function(t){var n=Object(p.a)(t,2),o=(n[0],n[1]),r=e.state.root$.getValue();e.state.root$.next(Object(M.a)({},r,{position:[o[0],o[1]]}))}}],["size",function(e){return function(t){var n=Object(p.a)(t,2),o=(n[0],n[1]),r=e.state.root$.getValue();e.state.root$.next(Object(M.a)({},r,{size:[o[0],o[1]]}))}}]],wt=[["data",function(e){return function(){return e.state.root$.getValue()}}]],kt=Be(oe),zt=ut(lt(function(e){return a.a.createElement(kt,e,a.a.createElement(Bt,{offsetPosition$:e.offsetPosition$}),a.a.createElement(Mt,{offsetPosition$:e.offsetPosition$}),e.children)},yt,[]),yt,[]),St=function(){var e=Object(c.useRef)([]),t=Le("stored-workspace",e.current,wt),n=Object(c.useState)(null),o=Object(p.a)(n,2),r=o[0],i=o[1],u=Object(c.useState)(null),s=Object(p.a)(u,2),l=s[0],f=s[1],b=Object(c.useRef)(null);Object(c.useEffect)(function(){if(r&&!b.current){var e=r.getBoundingClientRect();b.current=[e.left,e.top],console.log("cntRef effect!",b.current),f([e.left,e.top])}},[r,b]),Object(c.useEffect)(function(){return function(){console.log("destroy workspace!")}},[]);var g=t.get("data"),m=g.size,d=g.position;return console.log("%c render inside workspace","color: yellow; background-color: red"),a.a.createElement(mt,{setRef:i},l&&a.a.createElement(zt,{xy$:new ce.a([d[0],d[1]]),position$:new ce.a([d[0],d[1]]),size$:new ce.a([m[0],m[1]]),activeLevel$:new ce.a(O.None),offsetPosition$:new ce.a([l[0],l[1]]),guid:"root"}))};!function(e){e.Root="root",e.CircleBlock="circle",e.RectangleBlock="rectangle",e.ConditionBlock="condition",e.TimerBlock="timer"}(He||(He={}));var Vt=Object(d.a)({},He.RectangleBlock,{backgroundColor:"#37474f",boxShadow:"0 0 6px 2px rgba(255,255,255,.1)",color:"#f5f5f5"}),_t=Object(y.a)(new Array(4).fill(0).map(function(e,t){return{guid:"test-".concat(t),classType:"testClass",uiType:He.RectangleBlock,position:[Math.round(450*Math.random()+20*t),Math.round(250*Math.random()+20*t)],size:[Math.round(150*Math.random()+80),Math.round(90*Math.random()+70)],style:Vt[He.RectangleBlock]}})),$t={guid:"root",classType:"Root",position:[10,10],size:[700,500],uiType:He.Root},It={controls$:new ce.a(Object(y.a)(_t)),root$:new ce.a(Object(M.a)({},$t))},Nt=function(){var e=[new de(It,[]),Oe.Provider],t=Object(p.a)(e,2),n=t[0],o=t[1];return a.a.createElement(o,{value:n},a.a.createElement(St,null))},Ht=(n(460),g(Nt)),Ct=function(){return a.a.createElement("div",{className:"App"},a.a.createElement(m,{title:"Designer"},a.a.createElement(s.b,{activeClassName:"link-item--active",exact:!0,activeStyle:{color:"orange"},to:"/"},"Home")," \\\\",a.a.createElement(s.b,{activeClassName:"link-item--active",activeStyle:{color:"orange"},to:"/about"},"About")," \\\\",a.a.createElement(s.b,{activeClassName:"link-item--active",activeStyle:{color:"orange"},to:"/workspace"},"Workspace")),a.a.createElement(Ht,null))},Dt=function(){u.a.render(a.a.createElement(s.a,{basename:"#"},a.a.createElement(Ct,null)),document.getElementById("root"))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));Dt(),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[226,1,2]]]);
//# sourceMappingURL=main.c8eb939f.chunk.js.map